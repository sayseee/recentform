
async function fetchAndDisplayStandings(tournamentId, uniqueTournamentId, seasonId, customId, matchId, homeTeamId, awayTeamId, homeTeamName, awayTeamName) {
    try {
        // Fetch all necessary data in parallel
        const [
            homeStandingsResponse,
            awayStandingsResponse,
            totalStandingsResponse,
            homeTeamForms,
            awayTeamForms
        ] = await Promise.all([
            fetch(`https://api.sofascore.com/api/v1/tournament/${tournamentId}/season/${seasonId}/standings/home`).then(res => res.ok ? res.json() : null),
            fetch(`https://api.sofascore.com/api/v1/tournament/${tournamentId}/season/${seasonId}/standings/away`).then(res => res.ok ? res.json() : null),
            fetch(`https://api.sofascore.com/api/v1/tournament/${tournamentId}/season/${seasonId}/standings/total`).then(res => res.ok ? res.json() : null),
            fetchTeamForm(uniqueTournamentId, seasonId, 'home'),
            fetchTeamForm(uniqueTournamentId, seasonId, 'away'), 
        ]);

        // Check and clear home standings if data is missing
        if (!homeStandingsResponse) {
            document.getElementById('home-league-table').innerHTML = '';
        }

        // Check and clear away standings if data is missing
        if (!awayStandingsResponse) {
            document.getElementById('away-league-table').innerHTML = '';
        }

        // Check and clear total standings if data is missing
        if (!totalStandingsResponse) {
            document.getElementById('total-league-table').innerHTML = '';
            return; // Stop execution if total standings are missing
        }

        // Display team comparison info
        displayTeamInfo(homeTeamId, 'home-team-comparison', totalStandingsResponse, true);
        displayTeamInfo(awayTeamId, 'away-team-comparison', totalStandingsResponse, false);

        // Display league tables
        if (homeStandingsResponse) displayLeagueTable(homeStandingsResponse, 'Home', tournamentId, seasonId, matchId, homeTeamId, awayTeamId, homeTeamForms);
        if (awayStandingsResponse) displayLeagueTable(awayStandingsResponse, 'Away', tournamentId, seasonId, matchId, homeTeamId, awayTeamId, awayTeamForms);
        displayLeagueTable(totalStandingsResponse, 'Total', tournamentId, seasonId, matchId, homeTeamId, awayTeamId);
        
        const homeStatsData = await getTeamStats(uniqueTournamentId, seasonId, matchId, homeTeamId);
        const awayStatsData = await getTeamStats(uniqueTournamentId, seasonId, matchId, awayTeamId);

        const homeStats = homeStatsData[homeTeamId]; // Extract the stats object
        const awayStats = awayStatsData[awayTeamId]; // Extract the stats object

        displayCombinedTeamStats(homeStats, awayStats, homeTeamName, awayTeamName); 

 
         

    } catch (error) {
        console.error('Error fetching and displaying standings:', error);
        const leagueTableDiv = document.getElementById('league-table');
        leagueTableDiv.innerHTML = '<p>Error loading standings</p>';

        displayFallbackTeamInfo(homeTeamId, 'home-team-comparison', null, true); 
    }
}
