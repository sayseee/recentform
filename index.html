<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Live Soccer Scores, Results, Betting Odds | FUTBOL</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet"><link rel="manifest" href="manifest.json">
        
    <script src="https://cdn.jsdelivr.net/npm/luxon@2.0.2/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script> <!-- Add this line -->
        <style>
:root {   
    --bg-color-1: #010a0f; 
    --bg-color-2: #00141d;   
    --bg-active: #555e61;
    --color-highlight: #01203e;
    --color-support-1: #1b1b1b;
    --color-support-2-rgb: 200, 205, 205;
    --color-support-3: #ccdbd8;
    --color-support-4: #555e61;
    --color-support-5: #fff;
    --color-4: #ddf1fc; /* Medium shade */
    --win-color: #47ab99; /* Wins */
    --draw-color: #f3ca05;/* Draws */
    --loss-color: #e47454;/* Losses */
    --blue-5:  #F2F3FA;  /* Blue (5) */
    --blue-100: #020F2A; /* Blue (100) */
    --color-tabs-secondary-background-base: #0f2d37;
    --color-tabs-secondary-background-active: #c80037;
    --color-tabs-secondary-fill-active: #fff;
    --color-tabs-secondary-fill-base: #c8cdcd;
    --color-combination-8: #0f2d37;
}
body {
  font-family: "Arimo", sans-serif;
  font-optical-sizing: auto;
    font-weight: 400;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    font-size: 12px; 
    line-height: 1.5;
    color: var(--color-support-1);
    text-align: left;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: var(--bg-color-1);
}

.W, .D, .L {  
    color: #fff;
    align-items: center; 
    display: flex; 
    justify-content: center;
    overflow: hidden;
    position: relative; 
    padding:2px 0;
}
.win, .draw, .loss, .pos, .neg { 
    color: #fff;
    height: 14px;
    overflow: hidden;
    position: relative;
    padding: 2px 0;
    width: 18px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    margin-right: 2px;
    border-radius: 2px;
    float: right;
}
.W, .win, .pos {
    background-color: var(--win-color);
}
.D, .draw {
    background-color: var(--draw-color);
}
.L, .loss, .neg {
    background-color: var(--loss-color);
}
/* Constants */
.flex {
    display: flex;
}
._F_r{
    flex-direction: row !important;
}
._F_c{
    flex-direction: column !important;
}
._F_ac {
    align-items: center;
}
._F_jc {
    justify-content: space-between;
}
.gT5 {
    gap: 5px;
}
.gT10 {
    gap: 10px;
}
.gT20 {
    gap: 20px;
}
._F1 {
    flex: 1;
}
._F2 {
    flex: 2;
}
._F3 {
    flex: 3;
}
a {
    color: var(--color-support-1);
    text-decoration: none;
}
a:hover { 
    text-decoration: none;
}
header#superheader {
    background: var(--bg-color-2);
    padding: 5px 0;
    display: flex;
    gap: 50px;
    align-items: center;
    justify-content: space-between;
}
header .logo {
    font-size: 24px;
    color: var(--color-support-5);
    font-weight: 900;
    margin-left: 50px
}
.filter-bar {
    color: var(--color-support-5);
    display: flex;
    gap: 20px;
    margin-right: 20px;
}
/* Ensure the parent container is a flex container if using align-self */
.filter-bar input[type=date], .filter-bar input[type=select], button, .filter-bar select {    
    height: 30px;
    border: 0; 
    background-color:#000;
    color: var(--color-support-1);
    padding: 0 10px;
    border-radius: 4px;
}
/* Ensure the parent container is a flex container if using align-self */
.filter-bar input[type=date] {
    background-color:#000;
    border: 1px solid var(--color-support-3); 
    box-sizing: border-box;
    color: var(--color-support-1);
    padding: 10px;
    
    /* Remove align-self if not used within a flex container */
    /* align-self: flex-start; */
}
.filter-bar button {
    background-color: var(--color-support-4);
    color: var(--color-tabs-secondary-fill-base);
    font-weight: bold;
    padding: 5px 10px;
    cursor: pointer;
}
.filter-bar button:hover {
    background-color: var(--color-combination-8);
}
select {
    border: 0; 
    font-weight: 500;
    font-size: 14px;
    color: var(--color-tabs-secondary-fill-base) !important;
    background-color: var(--color-support-4) !important; 
}
/* Categories container */
main {
    height: 100%;
    display: grid;
    grid-template-areas: "categories mainAnalysis sideRight";
    grid-template-columns: 22.22% 48.31% 30.47%;
    grid-template-rows: minmax(calc(100vh - 310px), 1fr);
    position: relative;
}

/* Categories container */
.categories {
    height: calc(100vh - 46px); /* Fill the viewport height minus 76px */
    overflow-y: auto; /* Enable vertical scrolling */ 
    padding: 0; 
    background: #e9efed;
}

.categories::-webkit-scrollbar, #events-tabs .container-events::-webkit-scrollbar, #results-table::-webkit-scrollbar, .sideRight::-webkit-scrollbar {
    width: 0px; /* Set the width of the scrollbar */
}

.categories::-webkit-scrollbar-track, #events-tabs .container-events::-webkit-scrollbar-track, #results-table::-webkit-scrollbar-track, .sideRight::-webkit-scrollbar-track {
    background: transparent; /* Color of the track */
}

.categories::-webkit-scrollbar-thumb, #events-tabs .container-events::-webkit-scrollbar-thumb, #results-table::-webkit-scrollbar-thumb, .sideRight::-webkit-scrollbar-thumb {
    background: var(--color-support-3); /* Color of the thumb */
    border-radius: 1px; 
    height: 40px;
}
.categories h3 {
    font-size: 12px; 
}
#results-table {    
    height: 62vh;
    overflow-y: auto;
    padding-bottom: 25px;
}
.category-header {
    padding: 10px; 
    font-weight: 700;
    font-size: 12px;
    background-color: var(--color-support-3); 
}
.tournament h3 {
    margin: 0;
    padding: 10px;
    background-color: #dae6e4;
    display: flex;
    align-items: center;
}
.tournament h3 img {
    margin-right: 10px;
}
.tab-content#stats #stats-details {
    background-color: #dae6e4;
}
.tournament ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    justify-content: space-between;
    flex-direction: column;}
    .tournament ul li {
    display: flex;
    align-items: center;
    padding: 0 5px;
}  .tournament ul li:not(:first-child) {
    border-top: var(--color-support-3) 1px solid;   
} 
.tournament ul li a {
    background: none;
    border: none;
    cursor: pointer;
    font-weight: normal; 
    transition: all 0.3s ease;
    text-decoration: none;
    display: flex;
    width: 100%;}
 

.tournament a {
    text-decoration: none;
    display: flex;
    justify-content: space-between;
}

.match-card {
    display: flex;
    align-items: center; 
    padding: 5px 0; 
    width: 100%;
    cursor: pointer;
} 
#inprogress { 
    color: var(--color-tabs-secondary-background-active) !important;
} 
.match-status {
    color: #888;
}

.match-time-status {
    display: flex;
    flex-direction: column;
    margin-right: 8px;
    padding-right: 8px;
    text-align: center;
    flex: 0 0 45px;
    -webkit-box-flex: 0;
    font-size: 11px;
    color: #555;
    border-right: 1px solid rgba(34, 34, 38, 0.15);
    min-height: 45px;
    align-items: center;
    justify-content: center;
}
.team-info {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: calc(100% - 35px);
    margin-left: auto;
}
.teams-info { 
    display: flex;
    flex-direction: column;
    overflow-x: clip;
    min-width: 0px;
    margin-left: auto;
    flex: 1 1 140px;
    gap: 3px;
}
.team {
    display: flex;
    align-items: center;
}

.team-logo {
    width: 16px;
    height: 16px;
    margin-right: 8px;
}
 
.match-odds {
    display: flex;
    align-items: center;
    border-left: 1px solid rgba(34, 34, 38, 0.15);
    padding-left: 5px;
    flex-direction: column;
    font-size: 10px;
    flex: 0 0 35px;
}

.odds {
    margin: 0 4px; 
    font-weight: 500;
}
.odd-choice {
    display: flex;
    flex-direction: column;
    text-align: center;
    justify-content: space-between;
    gap: 5px;
    flex: 1;
}
.odd-choice span:first-child {
    color: rgb(74, 72, 72, 70%);
}
.match-score {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-left: 8px;
    flex: 0 0 20px; 
    font-weight: 700;
    color: #000;
    justify-content: space-around;
    gap: 5px;
} 
.mainAnalysis {
    grid-area: mainAnalysis;
    border-left: #e1ece8 1px solid;
    border-right: #e1ece8 1px solid;
    height: 100%; /* Fill the viewport height minus 76px */ 
    border-top: 0;
    background-color: #ffffff;
    padding-top: 10px;
}
nav {    
    align-items: center;
    display: flex;
    overflow-x: auto;
    width: 100%;
} 
nav ul {    
    margin: 0;
    padding: 0;
    list-style: none;
    align-items: center;
    display: flex;
    overflow-x: auto;
    width: 100%;
    padding: 10px;
}
nav li {    
    font-weight: 700;
    letter-spacing: .4px;
    line-height: 12px;
    text-transform: uppercase;
    white-space: nowrap;
}
nav li a {    
    align-items: center;
    background-color: var(--color-combination-8);
    border-radius: 1px;
    color: var(--color-tabs-secondary-fill-base);
    cursor: pointer;
    display: flex;
    height: 24px;
    margin-right: 8px;
    padding: 0 8px;
}
nav li a.active {    
    align-items: center;
    background-color: var(--color-tabs-secondary-background-active);
    color: var(--color-tabs-secondary-fill-active);
}
.duelParticipant {
    --spacer: 17px;
    display: grid;
    grid-template:
        "home time away" max-content
        "home score away" max-content
        ". . . " 5px / var(--width, minmax(110px, 250px)) var(--width, minmax(80px, 180px)) var(--width, minmax(110px, 250px));
    justify-content: center;
    padding: 0 10px; 
    text-align: center; 
}
.duelParticipant__home { 
    display: flex;
    justify-content: center;
    grid-area: home;
    font-weight: 700;
    text-align: center;
    flex-direction: column;
    gap: 20px;
}
.duelParticipant__away { 
    display: flex;
    justify-content: center;
    grid-area: away; 
    font-weight: 700;
    text-align: center;
    flex-direction: column;
    gap: 20px;
}
.duelParticipant__home img, .duelParticipant__away img { 
    height: 58px;
    width: 58px;
}
.duelParticipant__score { 
    display: grid;
    justify-content: center;
    grid-area: score;    
    flex-flow: row wrap; 
} 
.detailScore__wrapper{
    font-size: 40px;
    font-weight: 600;
}
.duelParticipant .match-time { 
    display: grid;
    grid-area: time;
    text-align: center;
}
.next-match-container {
    padding: 10px 20px;
    justify-content: center;
    display: flex;
    flex-direction: column;
}
#next-match {
    padding-top: 0; 
    justify-content: center;
    display: flex;
    flex-direction: row; 
}
#next-match .category-group { 
    font-weight: 500;
}
#next-match h3 {
    text-align: center;
    font-size: 12px;
    text-transform: uppercase;
    background-color: var(--color-support-3);
    padding: 10px;
    margin-bottom: 0;   
}
#home-next-match, #away-next-match {
    flex: 1;

}
.form-container h3, .h2h h3 {
    text-align: left;
    font-size: 12px;
    text-transform: uppercase;
    background-color: var(--color-support-3);
    padding: 10px;    
    margin: 0;
}
.h2h strong {
    color: var(--color-support-1);
    line-height: 16px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.home-form, .away-form, .atHome-form, .atAway-form {
    flex: 1;
} 

.event__row .tourn {
    width: 22px;
}

.event-row {padding:2px 5px; border-top: 1px solid #E6E9F695;}
.event-row:first-child {padding:4px; border-top: 0;}

.event-row:not(:first-child) {
    border-top: var(--color-support-3) 1px solid;   
} 

.event__row .score span {
    width: 16px;
    text-align: center;
}
.event-row .odds {
    display: flex;
    flex-direction: column;
    font-size: 10px;
    flex: 0 0 35px;
    align-items: center;
}

.event-row .odds-info {
    display: flex;    
    flex: 0 0 100px;
}
.event-row .odds-info span {
    flex: 1;
}

.time { 
    margin: 0;
    width: 55px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 10px;
}

.homeParticipant, .awayParticipant { 
    flex: 1;  
}  
.form-result {
    align-items: center; 
    border-radius: 1px; 
    display: flex;
    height: 16px;
    justify-content: center;
    overflow: hidden;
    position: relative;
    width: 20px;
}
.sideRight {
    grid-area: sideRight;
    height: 100%; /* Fill the viewport height minus 76px */
    overflow-y: auto; /* Enable vertical scrolling */
    padding-right: 10px;  
    background-color: #f5f7f6;
} 

.tab-menu {
    display: flex;
    border-bottom: 1px solid #b9bbbd; /* Light gray border */ 
    background-color: var(--color-support-3);
    padding: 10px;
}
 

.tab-button {
    align-items: center;
    background-color: var(--color-tabs-secondary-background-base);
    border-radius: 1px;
    color: var(--color-tabs-secondary-fill-base);
    display: flex;
    gap: 8px;
    height: 22px;
    padding: 0 8px;
    font-weight: 500;
    font-size: 12px;
    cursor: pointer;
    border: unset;
    font-family: inherit;
    line-height: 16px;
    outline: inherit;
    text-transform: uppercase;
    white-space: nowrap;
}


.tab-button:not(:first-child) {
    margin-left: 10px;
}

.tab-button:hover {
    background-color: var(--color-tabs-secondary-background-base);
}

.tab-button.active { 
    background-color: var(--color-tabs-secondary-background-active); 
    color: var(--color-tabs-secondary-fill-active);
}
.tab-content {
    display: none;
}

#events-tabs .container-events  {
    height: calc(100vh - 355px);
    overflow-y: auto;
}   
#events-tabs .tab-content { 
    padding: 0;
}

.tab-content.active {
    display: block;
}
#main-tabs .tab-content.active {
    display: block;
}
  
#standings-tabs .tab-content.active {
    display: block;
}
#standings-tabs  {
    position: relative;
}

.our-team {
    background-color: #bad8f5 !important;
    font-weight: 600;
}
/* Additional CSS for table styling */
table {
    width: 100%;
    border-collapse: collapse;
}
#standings-container table {
    font-size: 11px;
    height: 85vh; /* Set the height to the full viewport height */ 
}
table tr {
    display: flex;
    width: 100%;
}

#stats-details table th, #stats-details table td {
    flex: 1;
}

table th, table td { 
    border-bottom: 1px solid #e1ece8;
    align-items: center;
    align-self: center;
    display: inline-flex;
    height: 25px;
    width: 25px;
    justify-content: center;
} 

table th, table td { 
    text-align: center;
}

table th.--participant, table td.--participant { 
    flex-grow: 1;
    flex-shrink: 0;
    left: 32px;
    padding: 1px 10px;
    width: 100px;
    justify-content: left;
}
table th.--form, table td.--form {
    align-items: center;
    display: inline-flex;
    justify-content: flex-start;
    line-height: 14px;
    padding: 0 10px;
    width: 95px;
    justify-content: center;
} 
table th:nth-child(2), table td:nth-child(2) { 
    text-align: left;
}

table th {
    background-color: var(--color-5);
    text-align: left;
}  
.sideRight .tab-content { 
    overflow-y: auto; /* Enable vertical scrolling */
}
#results-table table th, #results-table table td {
    border-bottom: 1px solid 1px solid #e1ece8;
    align-items: center;
    align-self: center;
    display: inline-flex; 
    flex: 0.5;
    justify-content: center;
}
#results-table table th:nth-child(2), #results-table table td:nth-child(2), #results-table table th:nth-child(4), #results-table table td:nth-child(4) { 
    flex: 1; 
}
#results-table table th:nth-child(3), #results-table table td:nth-child(3) {
    border-bottom: 1px solid 1px solid #e1ece8;
    align-items: center;
    align-self: center;
    display: inline-flex; 
    flex: 3;
    justify-content: center;
}
#results-table table td:nth-child(2) div, #results-table table td:nth-child(2) div, #results-table table td:nth-child(4) div, #results-table table td:nth-child(4) div {
    display: flex;
    width: 100%;
    height: inherit;
}
#results-table .highlight {
    background-color: #bad8f5 !important;
    font-weight: 600;
}
/* Style for all elements with IDs starting with 'live-timer-' */
.detailScore__matchInfo.inprogress [id^="live-timer-"] { 
    color: #d9534f;   
    transition: background-color 0.3s ease;
    font-weight: 600;
}

.match-card .match-time-status.inprogress {
    color: #d9534f !important; /* Deep red color */
    transition: background-color 0.3s ease;
    font-weight: 600; /* Bold font */
    display: flex;
    flex-direction: row;
    justify-content: center;
}
.blink {
    animation: blink 1s infinite;
}

@keyframes blink {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}
.score.flex._F_c>span {
    display: flex; 
    gap: 5px;
}
.stats-container {
  display: flex;
  gap: 10px;
  background-color: transparent;
  padding: 10px;
}

.stat-card {
  background-color: #1c1c1c;
  color: white;
  padding: 10px;
  width: 100px;
  text-align: center; 
}

.stat-title {
  font-size: 11px;
  font-weight: bold;
  color: #ccc;
}

.stat-value {
  font-size: 14px;
  font-weight: bold;
  margin-top: 5px;
}
 
.trend-arrow {
  font-size: 14px;
  margin-left: 5px;
}

.trend-arrow.down { 
    color: #FB0000; 
}

.trend-arrow.up {
  color: #00AB00; /* Green color for up arrow */
}

.league-average {
  font-size: 12px;
  color: #ccc;
  margin-top: 5px;
}

     </style>
    </head>
    <body> 
        <header id="superheader">
            <div class="logo">FUTBOL</div>                                     
            <div class="main-nav"> 
                <nav class="filters">
                    <ul class="filters__group">
                        <li><a href="#all-games" data-status="all" class="active">All</a></li>
                        <li><a href="#live-games" data-status="live">LIVE</a></li>
                        <li><a href="#finished-games" data-status="finished">Results</a></li>
                        <li><a href="#scheduled-games" data-status="scheduled">Upcoming</a></li>
                    </ul>
                </nav> 
            </div>
            <div class="filter-bar">
                <div>
                    <button class="calendar__navigation calendar__navigation--yesterday" title="Previous day">&#8249;</button>
                    <button id="calendarMenu" aria-expanded="false" class="calendar__datepicker">
                        <span id="current-day"></span> <!-- Current date dynamically displayed here -->
                    </button>
                    <ul aria-labelledby="calendarMenu" class="calendar__days" id="date-list" hidden>
                        <!-- Dates will be appended here dynamically -->
                    </ul>
                    <button class="calendar__navigation calendar__navigation--tomorrow" title="Next day">&#8250;</button>
                </div>
                <div> 
                    <select id="time-range">
                        <option value="">Select Time</option>
                        <option value="3">3 Hours</option>
                        <option value="6">6 Hours</option>
                        <option value="12">12 Hours</option>
                    </select>
                    <button id="filter-btn">Filter</button> 
                </div> 
            </div>
        </header>
        <main>            
            <div id="categories-container" class="categories"></div>
            <div class="mainAnalysis"> 
                <div id="details-container"></div>
            </div>
            <div id="right-container" class="sideRight"></div>
        </main>
        
        <script>
        const baseURL = 'https://api.sofascore.com/api/v1';
        
        const fetchJson = async (url) => {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Error ${response.status}: ${errorData.message}`);
                }
                return response.json();
            } catch (error) {
                console.error('Fetch error:', error.message);
                return null;
            }
        };
        
// Helper function to convert fractional odds to decimal
function fractionalToDecimal(fractionalOdds) {
    const [numerator, denominator] = fractionalOdds.split('/');
    return (parseInt(numerator) / parseInt(denominator) + 1).toFixed(2);
}

// Function to fetch odds for an event
const fetchOddsForEvent = async (eventId) => {
    const url = `${baseURL}/event/${eventId}/odds/1/all`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        if (data && data.markets) {
            const fullTimeMarket = data.markets.find(market => market.marketName === 'Full time');
            if (fullTimeMarket && fullTimeMarket.choices) {
                return fullTimeMarket.choices.map(choice => ({
                    name: choice.name,
                    odds: fractionalToDecimal(choice.fractionalValue)
                }));
            }
        }
        return null; // Return null if no odds found
    } catch (error) {
        console.error('Error fetching odds:', error.message);
        return null;
    }
};

        const filterEventsByTime = (events, hours) => {
            const now = new Date().getTime();
            const timeRange = hours * 60 * 60 * 1000; // Convert hours to milliseconds

            return events.filter(event => {
                const eventTime = new Date(event.startTimestamp * 1000).getTime();
                return eventTime >= now && eventTime <= now + timeRange;
            });
        };
        
const displayCategories = async (date, hours, status) => {
    const topTournamentsUrl = `${baseURL}/config/top-unique-tournaments/UG/football`;
    const scheduledEventsUrl = `${baseURL}/sport/football/scheduled-events/${date}`;
    const scheduledEventsUrl2 = `${baseURL}/sport/football/scheduled-events/${date}/inverse`;
    const oddsResponse = `${baseURL}/sport/football/odds/1/${date}`;

    let filteredEvents = [];
    let odds = {};

    const fetchData = async () => {
        try {
            const topTournamentsData = await fetchJson(topTournamentsUrl);
            const scheduledEventsData = await fetchJson(scheduledEventsUrl);
            const scheduledEventsData2 = await fetchJson(scheduledEventsUrl2);
            const oddsData = await fetchJson(oddsResponse);

            const events = [...scheduledEventsData.events, ...scheduledEventsData2.events];
            odds = oddsData?.odds || {};

            // Filter by date range for the selected day
            const startDate = new Date(date).setHours(0, 0, 0);
            const endDate = new Date(date).setHours(23, 59, 59);

            filteredEvents = events.filter(event => {
                const eventTime = new Date(event.startTimestamp * 1000).getTime();
                return eventTime >= startDate && eventTime <= endDate;
            });

            // If hours are specified, filter further by time range
            if (hours) {
                const timeRangeStart = new Date(date).setHours(0, 0, 0);
                const timeRangeEnd = new Date(date).setHours(hours, 59, 59);

                filteredEvents = filteredEvents.filter(event => {
                    const eventTime = new Date(event.startTimestamp * 1000).getTime();
                    return eventTime >= timeRangeStart && eventTime <= timeRangeEnd;
                });
            }

            if (status) {
                filteredEvents = filteredEvents.filter(event => {
                    switch (status) {
                        case 'live':
                            return event.status.type === 'inprogress';
                        case 'finished':
                            return event.status.type === 'finished';
                        case 'scheduled':
                            return event.status.type === 'notstarted';
                        default:
                            return true;
                    }
                });
            }

            filteredEvents = filteredEvents.filter(event => odds[event.id]);

            const topTournaments = topTournamentsData.uniqueTournaments;
            const topTournamentIds = topTournaments.map(tournament => tournament.id);

            const container = document.getElementById('categories-container');
            container.innerHTML = '';

            const topTournamentsMap = new Map();
            const otherCategoriesMap = new Map();

            filteredEvents.forEach(event => {
                const categoryName = event.tournament.category.name;
                const tournamentId = event.tournament.uniqueTournament.id;
                const uniqueTournamentName = event.tournament.uniqueTournament.name;

                const targetMap = topTournamentIds.includes(tournamentId) ? topTournamentsMap : otherCategoriesMap;

                if (!targetMap.has(categoryName)) {
                    targetMap.set(categoryName, new Map());
                }

                const tournaments = targetMap.get(categoryName);
                if (!tournaments.has(uniqueTournamentName)) {
                    tournaments.set(uniqueTournamentName, {
                        id: tournamentId,
                        events: []
                    });
                }

                tournaments.get(uniqueTournamentName).events.push(event);
            });
            // Function to format time
            const formatTime = (time) => {
                return time < 10 ? `0${time}` : time;
            };

            // Function to calculate elapsed time
            const calculateElapsedTime = (event) => {
                const now = Math.floor(Date.now() / 1000);
                let elapsedSeconds = now - event.time.currentPeriodStartTimestamp;

                switch (event.status.description) {
                    case 'Halftime':
                        return "HT";
                    case 'Ended':
                        return "Ended";
                    case '1st half':
                        return elapsedSeconds < 2700 ? `${Math.floor(elapsedSeconds / 60)}<span class='blink'>'</span>` : `HT`;
                    case '2nd half':
                        return elapsedSeconds < 5400 ? `${Math.floor((elapsedSeconds + 2700) / 60)}<span class='blink'>'</span>` : `FT`;
                    default:
                        return `0<span class='blink'>'</span>`;
                }
            };

            // Function to start live timer
            const startLiveTimer = (event, timerElement) => {
                if (!timerElement) {
                    console.error(`Timer element not found for event ${event.id}`);
                    return;
                }

                const interval = setInterval(() => {
                    if (event.status.type === 'inprogress') {
                        timerElement.innerHTML = calculateElapsedTime(event);
                    } else if (event.status.type === 'finished' || event.status.description === 'FT') {
                        // Stop the timer when the match is finished
                        clearInterval(interval);
                        timerElement.innerHTML = calculateElapsedTime(event); // Update the final time
                        timerElement.classList.remove('blink'); // Stop the blinking effect
                        timerElement.classList.add('match-ended'); // Add styling for ended match
                    } else {
                        timerElement.innerHTML = calculateElapsedTime(event);
                    }
                }, 1000);
            };

            // Function to render tournament events
            const renderTournamentEvents = (tournament, eventsList, baseURL, odds) => {
                tournament.events.forEach((event) => {
                    const listItem = document.createElement('li');
                    const eventLink = document.createElement('a');
                    eventLink.className = 'match-card';
                    eventLink.dataset.eventId = event.id;

                    // Get odds data
                    const oddsData = odds[event.id] || {};
                    const homeFractional = oddsData.choices?.find((choice) => choice.name === '1')?.initialFractionalValue;
                    const drawFractional = oddsData.choices?.find((choice) => choice.name === 'X')?.initialFractionalValue;
                    const awayFractional = oddsData.choices?.find((choice) => choice.name === '2')?.initialFractionalValue;

                    const homeOdds = homeFractional ? fractionalToDecimal(homeFractional) : '-';
                    const drawOdds = drawFractional ? fractionalToDecimal(drawFractional) : '-';
                    const awayOdds = awayFractional ? fractionalToDecimal(awayFractional) : '-';

                    const homeScore = event.homeScore?.current ?? 0;
                    const awayScore = event.awayScore?.current ?? 0;

                    const isHomeTeamWinner = homeScore > awayScore;
                    const isAwayTeamWinner = awayScore > homeScore;

                    const homeTeamName = isHomeTeamWinner ? `<strong>${event.homeTeam.shortName}</strong>` : event.homeTeam.shortName;
                    const awayTeamName = isAwayTeamWinner ? `<strong>${event.awayTeam.shortName}</strong>` : event.awayTeam.shortName;

                    eventLink.innerHTML = `
                        <div class="match-time-status ${event.status.type}" id="match-timer-${event.id}"></div>
                        <div class="team-info">
                            <div class="teams-info">
                                <div class="team">
                                    <img src="${baseURL}/team/${event.homeTeam.id}/image" width="16" height="16" alt="${event.homeTeam.shortName}" loading="lazy" class="team-logo">
                                    <span class="team-name">${homeTeamName}</span>
                                </div>
                                <div class="team">
                                    <img src="${baseURL}/team/${event.awayTeam.id}/image" width="16" height="16" alt="${event.awayTeam.shortName}" loading="lazy" class="team-logo">
                                    <span class="team-name">${awayTeamName}</span>
                                </div>
                            </div>
                            <div class="match-score" id="${event.status.type}">
                                <span class="score" id="homeScore-${event.id}">${event.homeScore?.current ?? ''}</span>
                                <span class="score" id="awayScore-${event.id}">${event.awayScore?.current ?? ''}</span>
                            </div>
                            <div class="match-odds">
                                <div class="odd-choice"> 
                                    <span class="odds">${homeOdds}</span>
                                </div>
                                <div class="odd-choice"> 
                                    <span class="odds">${drawOdds}</span>
                                </div>
                                <div class="odd-choice"> 
                                    <span class="odds">${awayOdds}</span>
                                </div>
                            </div>                
                            </div>
                        </div>
                    `;

                    const matchTimeStatus = eventLink.querySelector(`#match-timer-${event.id}`);

                    if (event.status.type === 'inprogress') {
                        startLiveTimer(event, matchTimeStatus);
                    } else if (event.status.type === 'finished') {
                        matchTimeStatus.innerHTML = `
                            <span class="match-time">Ended</span>
                        `;
                    } else {
                        matchTimeStatus.innerHTML = `
                            <span class="match-time">${new Date(event.startTimestamp * 1000).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }).replace(',', ' ').replace('/', ' ')}</span>
                            <span class="match-status">${new Date(event.startTimestamp * 1000).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}</span>
                        `;
                    }

                    listItem.appendChild(eventLink);
                    eventsList.appendChild(listItem);
                });

                return eventsList;
            };

            // Function to create category section
            const createCategorySection = (tournaments, categoryName) => {
                const categoryItem = document.createElement('div');
                categoryItem.classList.add('category');

                const categoryHeader = document.createElement('div');
                categoryHeader.classList.add('category-header', 'flex', 'gT10', '_F_ac');

                const categoryImage = tournaments.values().next().value.events[0].tournament.category.alpha2
                    ? tournaments.values().next().value.events[0].tournament.category.alpha2.toLowerCase()
                    : tournaments.values().next().value.events[0].tournament.category.flag;

                categoryHeader.innerHTML = `
                    <img src="https://www.sofascore.com/static/images/flags/${categoryImage}.png" width="20" height="20" loading="lazy" />
                    <span><span class="cat-name">${categoryName}</span></span>
                `;

                categoryHeader.addEventListener('click', () => {
                    categoryItem.classList.toggle('active');
                    const tournamentsContainer = categoryItem.querySelector('.tournaments-container');
                    tournamentsContainer.style.display = categoryItem.classList.contains('active') ? 'block' : 'none';
                });

                const tournamentsContainer = document.createElement('div');
                tournamentsContainer.classList.add('tournaments-container');

                tournaments.forEach((tournament, uniqueTournamentName) => {
                    const tournamentSection = document.createElement('div');
                    tournamentSection.classList.add('tournament');

                    const tournamentHeader = document.createElement('h3');
                    tournamentHeader.classList.add('flex', '_F_ac');
                    const tournamentImage = `${baseURL}/unique-tournament/${tournament.id}/image`;
                    tournamentHeader.innerHTML = `
                        <img class="tourn" src="${tournamentImage}" alt="${uniqueTournamentName}" width="16" height="16" loading="lazy" />
                        ${uniqueTournamentName}
                    `;

                    tournamentSection.appendChild(tournamentHeader);

                    const eventsList = document.createElement('ul');
                    const renderedEventsList = renderTournamentEvents(tournament, eventsList, baseURL, odds);
                    tournamentSection.appendChild(renderedEventsList);
                    tournamentsContainer.appendChild(tournamentSection);
                });

                categoryItem.appendChild(categoryHeader);
                categoryItem.appendChild(tournamentsContainer);
                return categoryItem;
            };
            



            topTournamentsMap.forEach((tournaments, categoryName) => {
                const categoryItem = createCategorySection(tournaments, categoryName);
                container.appendChild(categoryItem);
            });

            otherCategoriesMap.forEach((tournaments, categoryName) => {
                const categoryItem = createCategorySection(tournaments, categoryName);
                container.appendChild(categoryItem);
            });

            if (filteredEvents.length > 0) {
                displayEventDetails(filteredEvents[0].id);
            }

            document.querySelectorAll('.match-card').forEach(card => {
                card.addEventListener('click', async (event) => {
                    const eventId = event.currentTarget.dataset.eventId;
                    await displayEventDetails(eventId);
                });
            });

        } catch (error) {
            console.error('Error displaying categories:', error);
        }
    };

    await fetchData();

        const updateScores = async () => {
            try {
                const updatedScores = await fetchJson(`${baseURL}/sport/football/events/live`);

                // Check if updatedScores contains a list of events under a specific property
                if (!updatedScores || !Array.isArray(updatedScores.events)) {
                    console.error('Updated scores does not contain a list of events:', updatedScores);
                    return;
                }

                updatedScores.events.forEach(updatedEvent => {
                    const event = filteredEvents.find(event => event.id === updatedEvent.id);
                    if (event) {
                        const homeScoreElement = document.getElementById(`homeScore-${event.id}`);
                        const awayScoreElement = document.getElementById(`awayScore-${event.id}`);
                        if (homeScoreElement) {
                            homeScoreElement.textContent = updatedEvent.homeScore?.current ?? '';
                        }
                        if (awayScoreElement) {
                            awayScoreElement.textContent = updatedEvent.awayScore?.current ?? '';
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating scores:', error);
            }
        };

            setInterval(updateScores, 5000);
        };


        
            const fetchNextMatch = async (teamId) => {
                const nextMatchUrl = `${baseURL}/team/${teamId}/events/next/0`;
                const nextMatchData = await fetch(nextMatchUrl).then(response => response.json());
                if (!nextMatchData || !nextMatchData.events || nextMatchData.events.length === 0) return null;
                return nextMatchData.events[1]; // Get the next match
            };

            const displayNextMatch = async (teamId, containerId) => {
            const match = await fetchNextMatch(teamId);
            const container = document.getElementById(containerId);

            // Create the header if it does not already exist
            let header = container.querySelector('h3.next-match-header');
            if (!header) {
                header = document.createElement('h3');
                header.className = 'next-match-header'; // Assign a class to style it if needed
                header.textContent = 'Next Match';
                container.appendChild(header); // Append header directly to the container
            }

            // Find the .next-match-container element or create it if it doesn't exist
            let matchContainer = container.querySelector('.next-match-container');
            if (!matchContainer) {
                matchContainer = document.createElement('div');
                matchContainer.className = 'next-match-container';
                container.appendChild(matchContainer);
            }

            if (!match) {
                // Display 'No upcoming matches' message and clear the match container
                matchContainer.innerHTML = ''; // Clear existing content
                matchContainer.appendChild(document.createElement('p')).textContent = 'No upcoming matches.';
                return;
            }

            // Extract relevant details from the match data
            const { homeTeam, awayTeam, startTimestamp, status, tournament } = match;
            const { uniqueTournament } = tournament;

            // Create the match details HTML
            const matchInfoHtml = `    
                    <div class="category-group flex _F_ac">
                        <div>
                            <img class="tourn" src="${baseURL}/unique-tournament/${uniqueTournament.id}/image" alt="${uniqueTournament.name}" width="20" height="20" loading="lazy">
                        </div> 
                        <div class="category-tournament" style="display: flex;"> 
                            <span class="tournament-name">${uniqueTournament.name}</span>
                        </div> 
                    </div> 
                    <div class="match-card">
                        <div class="match-time-status">
                            <span class="match-time">${new Date(startTimestamp * 1000).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' }).replace(',', ' ').replace('/', ' ')}</span>
                            <span class="match-status">${new Date(startTimestamp * 1000).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                        <div class="team-info">
                            <div class="teams-info">
                                <div class="team">
                                    <img src="${baseURL}/team/${homeTeam.id}/image" width="16" height="16" alt="${homeTeam.shortName}" loading="lazy" class="team-logo">
                                    <span class="team-name">${homeTeam.shortName}</span>
                                </div>
                                <div class="team">
                                    <img src="${baseURL}/team/${awayTeam.id}/image" width="16" height="16" alt="${awayTeam.shortName}" loading="lazy" class="team-logo">
                                    <span class="team-name">${awayTeam.shortName}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Update the match container's HTML content with the match details
                matchContainer.innerHTML = matchInfoHtml; // Update existing match container
            };

         // Utility function to fetch events data and filter for finished events excluding the current match
         const fetchEventsData = async (tournamentId, seasonId, currentMatchId) => {
                const eventsUrl = `${baseURL}/tournament/${tournamentId}/season/${seasonId}/events`;
                const eventsData = await fetchJson(eventsUrl);

                // Check if eventsData exists and contains events
                if (!eventsData || !eventsData.events) return [];

                // Filter only finished events and exclude the current match
                const finishedEvents = eventsData.events.reverse().filter(event => 
                    event.status.type === 'finished' && event.id !== currentMatchId
                );

                return finishedEvents;
            };


        const fetchTeamStats = (eventsForTeam, teamId, currentMatchId, currentMatchTimestamp)  => { 
            if (!eventsForTeam) return {}; 

            // Filter the events to include only those where the team was involved
            const teamEvents = eventsForTeam.filter(event => 
                (event.homeTeam.id === teamId || event.awayTeam.id === teamId) && 
                event.id !== currentMatchId
            );

            // Get the last 5 events, reversing to get them in chronological order
            const overallEvents = teamEvents;

            // Filter and slice home and away events separately
            const homeEvents = teamEvents.filter(event => event.homeTeam.id === teamId);
            const awayEvents = teamEvents.filter(event => event.awayTeam.id === teamId);

            // Function to calculate stats from the events
            const calculateStats = (events) => {
                const stats = {
                    wins: 0,
                    draws: 0,
                    losses: 0,
                    cleanSheets: 0,
                    failedToScore: 0,
                    btts: 0,
                    over1_5: 0,
                    over2_5: 0,
                    over3_5: 0,
                    results: [],
                    totalGoalsScored: 0,
                    totalGoalsConceded: 0,
                    totalGoalsPeriod1Scored: 0,
                    totalGoalsPeriod1Conceded: 0,
                    fatigue: 0,
                    avgDaysBetweenMatches: 0,
                };

                events.slice(0, 4).forEach(event => {
                    if (event.status.type === 'finished' && event.id !== currentMatchId) {
                        const isHome = event.homeTeam.id === teamId;
                        const teamScore = isHome ? event.homeScore.current : event.awayScore.current;
                        const opponentScore = isHome ? event.awayScore.current : event.homeScore.current;
                        const teamPeriod1Score = isHome ? event.homeScore.period1 : event.awayScore.period1;
                        const opponentPeriod1Score = isHome ? event.awayScore.period1 : event.homeScore.period1;
                        let result;
                        
                        if (teamScore > opponentScore) {
                            stats.wins++;
                            result = 'W';
                        } else if (teamScore < opponentScore) {
                            stats.losses++;
                            result = 'L';
                        } else {
                            stats.draws++;
                            result = 'D';
                        }

                        stats.results.push({
                            result,
                            eventId: event.id,
                            timeStamp: event.startTimestamp,
                            uniqueTournamentId: event.tournament.uniqueTournament?.id,
                            uniqueTournamentName: event.tournament.uniqueTournament?.name,
                            categoryName: event.tournament.category.name,
                            homeTeam: event.homeTeam.shortName,
                            awayTeam: event.awayTeam.shortName,
                            homeId: event.homeTeam.id,
                            awayId: event.awayTeam.id,
                            homeScore: event.homeScore.current,
                            awayScore: event.awayScore.current,
                            homePeriod1Score: event.homeScore.period1,
                            awayPeriod1Score: event.awayScore.period1
                        });

                        if (teamScore === 0) stats.failedToScore++;
                        if (opponentScore === 0) stats.cleanSheets++;

                        if (teamScore > 0 && opponentScore > 0) stats.btts++;
                        if (teamScore + opponentScore >= 2) stats.over1_5++;
                        if (teamScore + opponentScore >= 3) stats.over2_5++;
                        if (teamScore + opponentScore >= 4) stats.over3_5++;

                        stats.totalGoalsScored += teamScore;
                        stats.totalGoalsConceded += opponentScore;
                        stats.totalGoalsPeriod1Scored += teamPeriod1Score;
                        stats.totalGoalsPeriod1Conceded += opponentPeriod1Score;
                    }
                });

                return stats;
            };

            return {
                overall: calculateStats(overallEvents),
                home: calculateStats(homeEvents),
                away: calculateStats(awayEvents)
            };
        };

       

        const generateLast5OffStatsHTML = (stats, teamId) => {
            // Calculate percentages for the stats based on the total number of events
            const totalEvents = stats.results.length; 

            const failedToScorePercent = (stats.failedToScore / totalEvents) * 100;

            // Count how many times the team has scored 2 or more goals in a match
            const twoPlusGoalsEvents = stats.results.filter(event => {
                const isHome = event.homeId === teamId; // Correct comparison
                const goalsScored = isHome ? event.homeScore : event.awayScore;
                return goalsScored >= 2;
            }).length;
            const twoPlusGoalsPercent = (twoPlusGoalsEvents / totalEvents) * 100;
            // Count how many times the team has scored 2 or more goals in a match
            const twoPlusGoalsConceded = stats.results.filter(event => {
                const isHome = event.homeId === teamId; // Correct comparison
                const goalsConceded = isHome ? event.awayScore : event.homeScore;
                return goalsConceded >= 2;
            }).length;
            const twoPlusGoalsConcededPercent = (twoPlusGoalsConceded / totalEvents) * 100;

            return ` 
                <tr class="stats"> 
                    <td>${failedToScorePercent.toFixed(0)}%</td>
                    <td>${stats.totalGoalsScored} / ${stats.totalGoalsPeriod1Scored}</td>
                    <td>${stats.totalGoalsConceded} / ${stats.totalGoalsPeriod1Conceded}</td> 
                    <td>${twoPlusGoalsPercent.toFixed(0)}%</td>
                    <td>${twoPlusGoalsConcededPercent.toFixed(0)}%</td>
                </tr>
            `;
        };


 


        // Function to display the last 5 events with odds
        const displayLast5Events = async (teamStats, containerId) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const events = teamStats.results.slice(0, 4); // Get the last 5 events
            for (const event of events) { 
                 
                const homeScore = event.homeScore ?? 0;
                const awayScore = event.awayScore ?? 0;

                const isHomeTeamWinner = homeScore > awayScore;
                const isAwayTeamWinner = awayScore > homeScore;

                const homeTeamName = isHomeTeamWinner ? `<strong>${event.homeTeam}</strong>` : event.homeTeam;
                const awayTeamName = isAwayTeamWinner ? `<strong>${event.awayTeam}</strong>` : event.awayTeam;

                const homeTeamScore = isHomeTeamWinner ? `<strong>${event.homeScore}</strong>` : event.homeScore;
                const awayTeamScore = isAwayTeamWinner ? `<strong>${event.awayScore}</strong>` : event.awayScore;

                const homeTeamPeriod1Score = isHomeTeamWinner ? `<strong>${event.homePeriod1Score}</strong>` : event.homePeriod1Score;
                const awayTeamPeriod1Score = isAwayTeamWinner ? `<strong>${event.awayPeriod1Score}</strong>` : event.awayPeriod1Score;


                // Fetch odds for this event
                const odds = await fetchOddsForEvent(event.eventId);
                let oddsDisplay = '';
                if (odds) {
                    oddsDisplay = `<span>${odds[0]?.odds}</span><span>${odds[1]?.odds}</span><span>${odds[2]?.odds}</span>`;
                } else {
                    oddsDisplay = '<span>-</span><span>-</span><span>-</span>';
                }

                const eventElem = document.createElement('div');
                eventElem.className = 'event-row'; // Updated class name to match HTML/CSS
                eventElem.innerHTML = `  
                            <div class="event__row flex _F_r gT10 _F_ac" data-id="${event.eventId}">
                                <span class="event-date time">
                                    <span>    ${new Date(event.timeStamp * 1000).toLocaleDateString('en-GB', { 
                                        day: '2-digit', month: '2-digit', year: '2-digit' 
                                    }).replace(',', '.').replace('/', '.').replace('/', '.')}
                                
                                </span>
                                <span class="form-result ${event.result}">${event.result}</span>
                                </span>
                                <span class="tourn"><img src="${baseURL}/unique-tournament/${event.uniqueTournamentId}/image" alt="${event.uniqueTournamentName}"
                                    width="20" 
                                    height="20" 
                                    loading="lazy"
                                    onerror="this.onerror=null;this.src='https://www.sofascore.com/static/images/placeholders/tournament.svg';">
                                </span>
                                <span class="teamNames flex _F_c _F1">
                                    <span class="team-name homeParticipant">${homeTeamName}</span>
                                    <span class="team-name awayParticipant">${awayTeamName}</span> 
                                </span> 
                                <span class="score flex _F_c">
                                    <span><span>${homeTeamPeriod1Score}</span><span>${homeTeamScore}</span></span>
                                    <span><span>${awayTeamPeriod1Score}</span><span>${awayTeamScore}</span></span>
                                </span>
                                <span class="odds">
                                    ${oddsDisplay}
                                </span>
                            </div> 
                            `;
                    container.appendChild(eventElem);
                }
            };
           
            const calculateStatistics = async (teamId, tournamentId, seasonId, currentMatchId) => {
                const finishedEvents = await fetchEventsData(tournamentId, seasonId, currentMatchId);

                if (finishedEvents.length === 0) return null;

                // Initialize variables for calculating team and league stats
                let teamGoalsScored = 0, teamGoalsConceded = 0, teamMatches = 0;
                let teamBTTS = 0, teamOver1_5 = 0, teamOver2_5 = 0;

                let leagueGoals = 0, leagueMatches = 0, leagueBTTS = 0;
                let leagueOver1_5 = 0, leagueOver2_5 = 0;

                finishedEvents.forEach(event => { 
                    const isHome = event.homeTeam.id === teamId;
                    const teamScore = isHome ? event.homeScore.current : event.awayScore.current;
                    const opponentScore = isHome ? event.awayScore.current : event.homeScore.current;
                    const totalGoals = event.homeScore.current + event.awayScore.current;

                    // If teamId is provided, calculate team-specific stats
                    if (teamId && (event.homeTeam.id === teamId || event.awayTeam.id === teamId)) {
                        teamGoalsScored += teamScore;
                        teamGoalsConceded += opponentScore;
                        teamMatches += 1;
                        if (teamScore > 0 && opponentScore > 0) teamBTTS += 1;
                        if (totalGoals > 1.5) teamOver1_5 += 1;
                        if (totalGoals > 2.5) teamOver2_5 += 1;
                    }

                    // Calculate league-wide stats for every event
                    leagueGoals += totalGoals;
                    leagueMatches += 1;
                    if (event.homeScore.current > 0 && event.awayScore.current > 0) leagueBTTS += 1;
                    if (totalGoals > 1.5) leagueOver1_5 += 1;
                    if (totalGoals > 2.5) leagueOver2_5 += 1;
                });

                // Calculate averages for the team, if team-specific data is being calculated
                const teamStats = teamId ? {
                    goalsScored: (teamMatches > 0) ? (teamGoalsScored / teamMatches).toFixed(2) : 0,
                    BTTS: (teamMatches > 0) ? ((teamBTTS / teamMatches) * 100).toFixed(0) : 0,
                    over1_5: (teamMatches > 0) ? ((teamOver1_5 / teamMatches) * 100).toFixed(0) : 0,
                    over2_5: (teamMatches > 0) ? ((teamOver2_5 / teamMatches) * 100).toFixed(0) : 0
                } : null;

                // Calculate league-wide averages
                const leagueStats = {
                    goalsScored: (leagueMatches > 0) ? (leagueGoals / leagueMatches).toFixed(2) : 0,
                    BTTS: (leagueMatches > 0) ? ((leagueBTTS / leagueMatches) * 100).toFixed(0) : 0,
                    over1_5: (leagueMatches > 0) ? ((leagueOver1_5 / leagueMatches) * 100).toFixed(0) : 0,
                    over2_5: (leagueMatches > 0) ? ((leagueOver2_5 / leagueMatches) * 100).toFixed(0) : 0
                };

                return { teamStats, leagueStats };
            };


        // Function to fetch H2H events
        const fetchH2HEvents = async (customId, currentMatchId, teamId) => {
            const url = `${baseURL}/event/${customId}/h2h/events`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data && data.events) {
                    // Filter events based on the status and team ID
                    const finishedEvents = data.events
                        .filter(event => event.status && event.status.type === 'finished' && event.id !== currentMatchId)
                        .sort((a, b) => a.startTimestamp - b.startTimestamp);
                    return finishedEvents;
                } else {
                    return [];
                }
            } catch (error) {
                console.error('Error fetching H2H events:', error.message);
                return [];
            }
        };

        // Function to determine the result of the match
        const determineResult = (homeScore, awayScore, teamId, homeTeamId) => {
            if (homeScore > awayScore) {
                return teamId === homeTeamId ? 'W' : 'L';
            } else if (homeScore < awayScore) {
                return teamId === homeTeamId ? 'L' : 'W';
            } else {
                return 'D';
            }
        };
        // Function to display H2H events in the specified container, including odds
    const displayH2H = async (h2hData, containerId, teamId, filterHomeOnly = false) => {
    const container = document.getElementById(containerId);
            container.innerHTML = '';

            // Check if h2hData is empty or undefined
            if (!h2hData || h2hData.length === 0) {
                const errorElem = document.createElement('div');
                errorElem.className = 'error-message';
                errorElem.innerHTML = `<p>No head-to-head data available.</p>`;
                container.appendChild(errorElem);

                // Proceed with other application code here if needed
                console.error('No H2H data found');
                return; // Exit early since there's no H2H data to display
            }

            // Calculate the UNIX timestamp for 3 years ago
            const threeYearsAgoTimestamp = Math.floor(Date.now() / 1000) - (4 * 365 * 24 * 60 * 60);

            // Filter events based on the last 3 years and home/away preference
            const filteredEvents = h2hData
                .filter(event => event.startTimestamp >= threeYearsAgoTimestamp) // Only events from the last 3 years
                .filter(event => filterHomeOnly 
                    ? event.homeTeam.id === teamId // Only home team events at home
                    : (event.homeTeam.id === teamId || event.awayTeam.id === teamId) // All relevant events
                );

            // Display an error if no events match the criteria
            if (filteredEvents.length === 0) {
                const errorElem = document.createElement('div');
                errorElem.className = 'error-message';
                errorElem.innerHTML = `<p>No head-to-head data available for the last 3 years.</p>`;
                container.appendChild(errorElem);
                return;
            }

            // Display events in reverse chronological order
            for (const event of filteredEvents.reverse()) {
                const homeScore = event.homeScore?.current ?? 0;
                const awayScore = event.awayScore?.current ?? 0;

                // Determine the match result (W, D, L) based on the score
                const result = determineResult(homeScore, awayScore, teamId, event.homeTeam.id);

                const isHomeTeamWinner = homeScore > awayScore;
                const isAwayTeamWinner = awayScore > homeScore;

                const homeTeamName = isHomeTeamWinner ? `<strong>${event.homeTeam.shortName}</strong>` : event.homeTeam.shortName;
                const awayTeamName = isAwayTeamWinner ? `<strong>${event.awayTeam.shortName}</strong>` : event.awayTeam.shortName;

                const homeTeamScore = isHomeTeamWinner ? `<strong>${homeScore}</strong>` : homeScore;
                const awayTeamScore = isAwayTeamWinner ? `<strong>${awayScore}</strong>` : awayScore;

                // Fetch odds for the current event
                const odds = await fetchOddsForEvent(event.id);

                const oddsInfo = odds ? `
                    <div class="odds-info">
                        <span>${odds.find(o => o.name === '1')?.odds || '-'}</span>
                        <span>${odds.find(o => o.name === 'X')?.odds || '-'}</span>
                        <span>${odds.find(o => o.name === '2')?.odds || '-'}</span>
                    </div>
                ` : '<div class="odds-info"><span>-</span><span>-</span><span>-</span></div>';


                const eventElem = document.createElement('div');
                eventElem.className = 'event-row';
                eventElem.innerHTML = `
                    <div class="event__row flex _F_r gT10 _F_ac" data-id="${event.id}">
                        <span class="event-date time">${new Date(event.startTimestamp * 1000).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: '2-digit' }).replace(',', '.').replace('/', '.').replace('/', '.')}</span>
                        <span class="tourn"><img src="${baseURL}/unique-tournament/${event.tournament.uniqueTournament?.id}/image" alt="${event.tournament.uniqueTournament?.name}"
                                    width="20" 
                                    height="20" 
                                    loading="lazy"
                                    onerror="this.onerror=null;this.src='https://www.sofascore.com/static/images/placeholders/tournament.svg';">
                                </span>
                        <span class="teamNames flex _F_c _F1">
                            <span class="team-name homeParticipant">${homeTeamName}</span>
                            <span class="team-name awayParticipant">${awayTeamName}</span> 
                        </span> 
                        <span class="score flex _F_c">
                            <span>${homeTeamScore}</span>
                            <span>${awayTeamScore}</span>
                        </span>
                        <span class="form-result ${result}">${result}</span>
                        ${oddsInfo}  <!-- Display odds -->
                    </div> 
                `;
                container.appendChild(eventElem);
            }
        };
        
            
            const fetchAndDisplayResults = (eventsForTeam, currentHomeTeamId, currentAwayTeamId, containerId) => {
                try {
                    if (!eventsForTeam) return;

                    // Filter finished events for the current teams
                    const filteredEvents = eventsForTeam.filter(event => event.status.type === 'finished');


                    const teams = {};

                    filteredEvents.forEach(event => {
                        if (!teams[event.homeTeam.id]) {
                            teams[event.homeTeam.id] = { id: event.homeTeam.id, name: event.homeTeam.shortName, points: 0, results: [] };
                        }
                        if (!teams[event.awayTeam.id]) {
                            teams[event.awayTeam.id] = { id: event.awayTeam.id, name: event.awayTeam.shortName, points: 0, results: [] };
                        }

                        const homeResultClass = event.homeScore.current > event.awayScore.current ? 'W' 
                                                                : event.homeScore.current < event.awayScore.current ? 'L' 
                                                                : 'D';

                        const awayResultClass = event.awayScore.current > event.homeScore.current ? 'W' 
                                                                : event.awayScore.current < event.homeScore.current ? 'L' 
                                                                : 'D';

                        const addResult = (isHome, event, teamScore, opponentScore, homeResultClass, awayResultClass, teams) => {
                            const result = {
                                location: isHome ? 'home' : 'away',
                                opponent: isHome ? event.awayTeam.id : event.homeTeam.id,
                                score: isHome ? `${teamScore} - ${opponentScore}` : `${opponentScore} - ${teamScore}`,
                                resultClass: isHome ? awayResultClass : homeResultClass
                            };
                            teams[isHome ? event.homeTeam.id : event.awayTeam.id].results.push(result);
                        };

                        addResult(true, event, event.homeScore.current, event.awayScore.current, homeResultClass, awayResultClass, teams);
                        addResult(false, event, event.awayScore.current, event.homeScore.current, homeResultClass, awayResultClass, teams);

                        if (event.homeScore.current > event.awayScore.current) {
                            teams[event.homeTeam.id].points += 3;
                        } else if (event.homeScore.current < event.awayScore.current) {
                            teams[event.awayTeam.id].points += 3;
                        } else {
                            teams[event.homeTeam.id].points += 1;
                            teams[event.awayTeam.id].points += 1;
                        }
                    });

                    const sortedTeams = Object.values(teams).sort((a, b) => b.points - a.points);

                    let tableHTML = `<table width="100%">
                    <thead>
                        <tr>
                         <th>#</th>
                        <th>Home</th> 
                        <th style="text-align:center;">Opponent</th> 
                        <th>Away</th>
                        <th>Points</th> 
                        </tr>
                    </thead>
                    <tbody>`;

                    // Loop through sorted teams to generate table rows
                    sortedTeams.forEach((team, index) => {
                        const highlightClass = (team.id === currentHomeTeamId || team.id === currentAwayTeamId) ? 'highlight' : '';

                        tableHTML += `<tr>
                            <td>${index + 1}</td> <!-- Display index (position) -->
                            <td>${team.results
                            .filter(result => result.opponent === currentHomeTeamId && result.location === 'away')
                            .map(result => `<div class="${result.resultClass}">${result.score}</div>`).join('<br>')}</td> 
                            <td class="${highlightClass}" style="text-align:center;">${team.name}</td> 
                            <td>${team.results
                            .filter(result => result.opponent === currentAwayTeamId && result.location === 'home')
                            .map(result => `<div class="${result.resultClass}">${result.score}</div>`).join('<br>')}</td>
                            <td>${team.points}</td> <!-- Display points -->
                        </tr>`;
                    });

                    tableHTML += `</tbody></table>`;

                    // Update the container with the generated table HTML
                    const container = document.getElementById(containerId);
                    if (container) { // Check if container exists
                        container.innerHTML = tableHTML;
                    } else {
                        console.error(`Container with ID "${containerId}" not found.`);
                    }

                } catch (error) {
                    console.error('Error fetching events:', error);
                    const container = document.getElementById(containerId);
                    if (container) { // Check if container exists
                        container.innerHTML = '<p>Error fetching results data.</p>';
                    }
                }
            };


                            
            async function fetchOdds(currentMatchId) {
                try { 
                    const response = await fetch(`${baseURL}/event/${currentMatchId}/odds/1/changes`);
                    const data = await response.json();
                    return data.changedOdds;
                } catch (error) {
                    console.error('Error fetching odds:', error);
                }
            } 
            const updateStandingsContainer = async (eventData) => {
    try {
        const homeTeamId = eventData.homeTeam.id;
        const awayTeamId = eventData.awayTeam.id;
        const currentMatchId = eventData.id;
        const currentMatchTimestamp = eventData.startTimestamp;

        const tournamentId = eventData.tournament.id;
        const uniqueTournamentId = eventData.tournament.uniqueTournament.id;
        const seasonId = eventData.season.id;

        await displayNextMatch(homeTeamId, 'home-next-match');
        await displayNextMatch(awayTeamId, 'away-next-match');
        
            // Fetch events data
        const eventsForTeam = await fetchEventsData(tournamentId, seasonId, currentMatchId);

        // Fetch statistics for home and away teams, excluding the current match
        const homeStats = await calculateStatistics(homeTeamId, tournamentId, seasonId, currentMatchId);
        const awayStats = await calculateStatistics(awayTeamId, tournamentId, seasonId, currentMatchId);
        const overallStats = await calculateStatistics(null, tournamentId, seasonId, currentMatchId);

        // Fetch and display home team stats
        const homeTeamStats = await fetchTeamStats(eventsForTeam, homeTeamId, currentMatchId, currentMatchTimestamp);
        displayLast5Events(homeTeamStats.overall, 'home-team-form');
        displayLast5Events(homeTeamStats.home, 'at-home-form');

        // Fetch and display away team stats
        const awayTeamStats = await fetchTeamStats(eventsForTeam, awayTeamId, currentMatchId, currentMatchTimestamp);
        displayLast5Events(awayTeamStats.overall, 'away-team-form');
        displayLast5Events(awayTeamStats.away, 'at-away-form');

        const combinedStats = {
            goalsScored: ((parseFloat(homeStats.teamStats.goalsScored) + parseFloat(awayStats.teamStats.goalsScored))).toFixed(2),
            BTTS: ((parseFloat(homeStats.teamStats.BTTS) + parseFloat(awayStats.teamStats.BTTS)) / 2),
            over1_5: ((parseFloat(homeStats.teamStats.over1_5) + parseFloat(awayStats.teamStats.over1_5)) / 2),
            over2_5: ((parseFloat(homeStats.teamStats.over2_5) + parseFloat(awayStats.teamStats.over2_5)) / 2)
        };

            const leagueStats = overallStats.leagueStats;
 
        // Generate HTML for home and away team stats
        const homeTeamOffStatsHTML = generateLast5OffStatsHTML(homeTeamStats.overall, homeTeamId);
        const awayTeamOffStatsHTML = generateLast5OffStatsHTML(awayTeamStats.overall, awayTeamId); 
        const h2hEvents = await fetchH2HEvents(eventData.customId, currentMatchId, homeTeamId);

        // Filter H2H events from the last 5 years
        const filteredH2HEvents = h2hEvents.filter(h2hEvent => {
            const eventDate = new Date(h2hEvent.startTimestamp * 1000);
            const fiveYearsAgo = new Date();
            fiveYearsAgo.setFullYear(fiveYearsAgo.getFullYear() - 5);
            return eventDate >= fiveYearsAgo;
        });

        // Display overall head-to-head
        displayH2H(filteredH2HEvents, 'overallH2HContainer', homeTeamId, false);

        // Display only home team at home head-to-head
        displayH2H(filteredH2HEvents, 'homeTeamH2HContainer', homeTeamId, true);

        // Fetch and render odds for the current match
        const odds = await fetchOdds(currentMatchId);
        if (odds) {
            // renderChart(odds);
        }
        const tolerance = 0.01;
        // Update the right container with the stats tab and results tab
        document.getElementById('right-container').innerHTML = `
            <div id="main-tabs" class="tab-contentContainer">
                <div class="tab-menu">
                    <div class="tab-button active" data-tab="stats">STATS</div>
                    <div class="tab-button" data-tab="results">Results</div>
                </div>
                <div class="tab-content active" id="stats"> 
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-title">GOALS</div>
                            <div class="stat-value">
                                <span class="team-value">${combinedStats.goalsScored}</span>
                                <span class="trend-arrow ${Math.abs(combinedStats.goalsScored - leagueStats.goalsScored) < tolerance ? '' : (combinedStats.goalsScored > leagueStats.goalsScored ? 'up' : 'down')}">
                                    ${Math.abs(combinedStats.goalsScored - leagueStats.goalsScored) < tolerance ? '' : (combinedStats.goalsScored > leagueStats.goalsScored ? '▲' : '▼')}
                                </span>
                            </div>
                            <div class="league-average">L - ${leagueStats.goalsScored}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">BTTS</div>
                            <div class="stat-value">
                                <span class="team-value">${combinedStats.BTTS}%</span>
                                <span class="trend-arrow ${Math.abs(combinedStats.BTTS - leagueStats.BTTS) < tolerance ? '' : (combinedStats.BTTS > leagueStats.BTTS ? 'up' : 'down')}">
                                    ${Math.abs(combinedStats.BTTS - leagueStats.BTTS) < tolerance ? '' : (combinedStats.BTTS > leagueStats.BTTS ? '▲' : '▼')}
                                </span>
                            </div>
                            <div class="league-average">L - ${leagueStats.BTTS}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">OVER 1.5</div>
                            <div class="stat-value">
                                <span class="team-value">${combinedStats.over1_5}%</span>
                                <span class="trend-arrow ${Math.abs(combinedStats.over1_5 - leagueStats.over1_5) < tolerance ? '' : (combinedStats.over1_5 > leagueStats.over1_5 ? 'up' : 'down')}">
                                    ${Math.abs(combinedStats.over1_5 - leagueStats.over1_5) < tolerance ? '' : (combinedStats.over1_5 > leagueStats.over1_5 ? '▲' : '▼')}
                                </span>
                            </div>
                            <div class="league-average">L - ${leagueStats.over1_5}%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">OVER 2.5</div>
                            <div class="stat-value">
                                <span class="team-value">${combinedStats.over2_5}%</span>
                                <span class="trend-arrow ${Math.abs(combinedStats.over2_5 - leagueStats.over2_5) < tolerance ? '' : (combinedStats.over2_5 > leagueStats.over2_5 ? 'up' : 'down')}">
                                    ${Math.abs(combinedStats.over2_5 - leagueStats.over2_5) < tolerance ? '' : (combinedStats.over2_5 > leagueStats.over2_5 ? '▲' : '▼')}
                                </span>
                            </div>
                            <div class="league-average">L - ${leagueStats.over2_5}%</div>
                        </div>
                    </div>
                    <div id="stats-details">
                         <table>
                            <thead>
                                <tr>
                                    <th>FTS</th> <th>TGF</th> <th>TGA</th> <th>S2+</th> <th>C2+</th>
                                </tr>
                            </thead>
                            <tbody> 
                                ${homeTeamOffStatsHTML}
                                ${awayTeamOffStatsHTML}
                            </tbody>
                        </table>
                    </div> 
                    
                    <div id="results-table"></div>
                </div>
                <div class="tab-content" id="results">
                </div>
            </div>
        `; 
    // Add further checks for results-table
    const resultsTable = document.getElementById('results-table');
        if (resultsTable) { 
            fetchAndDisplayResults(eventsForTeam, homeTeamId, awayTeamId, 'results-table');
        } else {
            console.error('Results table not found.');
        }
        } catch (error) {
            console.error('An error occurred:', error);
            document.getElementById('right-container').innerHTML = `<p>No standings</p>`;
        } 

        // Add event listeners for events tabs
    document.querySelectorAll('#events-tabs .tab-button').forEach(button => {
        button.addEventListener('click', () => {
            const tab = button.getAttribute('data-tab');

            document.querySelectorAll('#events-tabs .tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#events-tabs .tab-content').forEach(content => content.classList.remove('active'));

            button.classList.add('active');
            document.getElementById(tab).classList.add('active');
        });
    });  
    // Function to handle tab switching
    const handleTabClick = (event, tabContainer) => {
        const buttons = tabContainer.querySelectorAll('.tab-button');
        const contents = tabContainer.querySelectorAll('.tab-content');

        buttons.forEach(button => button.classList.remove('active'));
        contents.forEach(content => content.classList.remove('active'));

        const tabButton = event.target;
        const tabContent = tabContainer.querySelector(`#${tabButton.getAttribute('data-tab')}`);

        tabButton.classList.add('active');
        tabContent.classList.add('active');
    };

     
    // Add event listeners for main tabs
    const mainTabsContainer = document.getElementById('main-tabs');
    const mainTabButtons = mainTabsContainer.querySelectorAll('.tab-button');

    mainTabButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            handleTabClick(event, mainTabsContainer);

            // Check which main tab is active and ensure the first sub-tab is active
            const activeMainTab = event.target.getAttribute('data-tab');
            if (activeMainTab === 'standings' || activeMainTab === 'results' || activeMainTab === 'form' || activeMainTab === 'over-under' || activeMainTab === 'btts' || activeMainTab === 'htft') {
                activateFirstSubTab(activeMainTab);
            }
        });
    });

    // Activate the first sub-tab within the active main tab
    const activateFirstSubTab = (tabId) => {
        const tabContent = document.getElementById(tabId);
        if (!tabContent) return;

        // Reset active state for all sub-tabs
        tabContent.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
        tabContent.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        // Activate the first sub-tab
        const firstSubTabButton = tabContent.querySelector('.tab-menu .tab-button');
         if (firstSubTabButton) {
        const firstSubTabContentId = firstSubTabButton.getAttribute('data-tab');
        const firstSubTabContent = tabContent.querySelector(`#${firstSubTabContentId}`);

        firstSubTabButton.classList.add('active');
        if (firstSubTabContent) {
            firstSubTabContent.classList.add('active');

            // If the first sub-tab has its own sub-tabs, activate the first tab
            const subSubTabButtons = firstSubTabContent.querySelectorAll('.tab-button');
            if (subSubTabButtons.length > 0) {
                handleTabClick({ target: subSubTabButtons[0] }, firstSubTabContent);
            }
        }
    }
    };

      
 
        };
        const displayEventDetails = async (eventId) => {
    // Function to fetch and display event details
    const fetchAndDisplayDetails = async () => {
        try {
            const eventDetails = await fetchJson(`${baseURL}/event/${eventId}`);
            if (!eventDetails) return;
            const eventData = eventDetails.event;
            const eventContainer = document.getElementById('details-container');

         
            eventContainer.innerHTML = `
                <div class="duelParticipant"> 
                    <div class="match-time">
                        <span>${new Date(eventData.startTimestamp * 1000).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).replace(',', ' ').replace('/', ' ')}</span>
                    </div>
                    <div class="team duelParticipant__home">
                        <img src="${baseURL}/team/${eventData.homeTeam.id}/image" width="16" height="16" alt="${eventData.homeTeam.shortName}" loading="lazy" class="team-logo">
                        <div class="team-name">${eventData.homeTeam.shortName}</div>
                    </div>

                    <div class="duelParticipant__score score">
                        <div class="detailScore__matchInfo ${eventData.status.type}">
                            <div class="detailScore__wrapper" id="${eventData.status.type}">
                                <span class="score" id="homeScores-${eventData.id}">${eventData.homeScore?.current ?? ''}</span>
                                <span class="detailScore__divider">-</span>
                                <span class="score" id="awayScores-${eventData.id}">${eventData.awayScore?.current ?? ''}</span>
                            </div>
                            <div class="detailScore__status">
                                <span id="live-timer-${eventData.id}"></span>
                            </div>
                        </div> 
                    </div>
                    <div class="team duelParticipant__away">
                        <img src="${baseURL}/team/${eventData.awayTeam.id}/image" width="16" height="16" alt="${eventData.awayTeam.shortName}" loading="lazy" class="team-logo">
                        <div class="team-name">${eventData.awayTeam.shortName}</div>
                    </div>
                </div>                    
                <div id="next-match" class="flex _F_r _F_jc">
                    <div id="home-next-match" class="next-match"></div>
                    <div id="away-next-match" class="next-match"></div>
                </div>                   
                <!-- Tabs Navigation -->
                <div id="events-tabs" class="tab-contentContainer">
                    <div id="match-odds" class="flex _F_r _F_jc">  
                    </div> 
                    <div class="tab-menu">
                        <button class="tab-button" data-tab="overall-events">Overall</button>
                        <button class="tab-button active" data-tab="home-vs-away-events">Home vs Away</button>
                    </div>
                    <div class="container-events">
                    <div class="tab-content" id="overall-events">
                        <div class="form-container">
                            <h3>Last matches</h3>
                            <div class="flex _F_r _F_jc gT20">
                                <div class="home-form">
                                    <div id="home-team-form"></div>
                                </div>
                                <div class="away-form"> 
                                    <div id="away-team-form"></div>
                                </div>
                            </div>
                        </div> 
                        <div class="h2h">
                            <h3>Head-to-head matches</h3>
                            <div id="overallH2HContainer"></div>
                        </div>
                    </div>
                    <div class="tab-content active" id="home-vs-away-events">
                        <div class="form-container">
                            <h3>Last matches</h3>
                            <div class="flex _F_r _F_jc gT20">
                                <div class="atHome-form"> 
                                    <div id="at-home-form"></div>
                                </div>
                                <div class="atAway-form"> 
                                    <div id="at-away-form"></div>
                                </div>
                            </div>
                        </div>                                        
                        <div class="h2h">
                            <h3>Head-to-head matches</h3>
                            <div id="homeTeamH2HContainer"></div>
                        </div>
                    </div>
                    </div>
                </div>                  
            `;

            // Start the live timer if the match is in progress
            if (eventData.status.type === 'inprogress') {
                startLiveTimer(eventData);
            } else if (eventData.status.description === 'Ended') {
                const timerElement = document.getElementById(`live-timer-${eventData.id}`);
                timerElement.innerHTML = 'Ended';
            }

            // Update the standings container
            updateStandingsContainer(eventData);

        } catch (error) {
            console.error('Error displaying event details:', error);
        }
    };

    const formatTime = (time) => {
        return time < 10 ? `0${time}` : time; // Add leading zero if less than 10
    };

    const calculateElapsedTime = (eventData) => {
        const now = Math.floor(Date.now() / 1000);
        let elapsedSeconds = now - eventData.currentPeriodStartTimestamp;

        // Check for match status descriptions
        if (eventData.status.description === 'Halftime') {
            return "Halftime"; // Display Halftime when it's halftime
        } else if (eventData.status.description === 'Ended') {
            return "Ended"; // Display Ended when the match has ended
        } else if (eventData.status.description === '1st half') {
            if (elapsedSeconds < 2700) {
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;
                return `${formatTime(minutes)}:${formatTime(seconds)}`; // Format as MM:SS
            }
            return "Halftime"; // Full time for 1st half
        } else if (eventData.status.description === '2nd half') {
            if (elapsedSeconds < 5400) {
                const minutes = Math.floor((elapsedSeconds + 2700) / 60); // Add 2700 seconds for the 1st half
                const seconds = (elapsedSeconds + 2700) % 60;
                return `${formatTime(minutes)}:${formatTime(seconds)}`; // Format as MM:SS
            }
            return "Ended"; // Full time for 2nd half
        }
        if (eventData.status.description === 'Ended') {
            return 'FT'; // Return FT when the match is ended
        }
        return "00:00"; // Default if not in progress
    };

        const startLiveTimer = (eventData) => {
        const timerElement = document.getElementById(`live-timer-${eventData.id}`);
        const interval = setInterval(() => {
            if (eventData.status.type === 'inprogress') {
                const elapsedTime = calculateElapsedTime(eventData);
                timerElement.innerHTML = `${elapsedTime}`;
            } else {
                clearInterval(interval); // Stop the timer if the game is finished
                timerElement.innerHTML = calculateElapsedTime(eventData); // Display the final state (FT)
            }
        }, 1000); // Update every second
    };

    // Initial display of event details
    await fetchAndDisplayDetails();

    // Function to refresh scores
    const refreshScores = async () => {
        try {
            const updatedEventDetails = await fetchJson(`${baseURL}/event/${eventId}`);
            if (!updatedEventDetails) return;
            const updatedEventData = updatedEventDetails.event;

            const homeScoreElement = document.getElementById(`homeScores-${eventId}`);
            const awayScoreElement = document.getElementById(`awayScores-${eventId}`);
            if (homeScoreElement) {
                homeScoreElement.textContent = updatedEventData.homeScore?.current ?? '';
            }
            if (awayScoreElement) {
                awayScoreElement.textContent = updatedEventData.awayScore?.current ?? '';
            }

        } catch (error) {
            console.error('Error refreshing scores:', error);
        }
    };

    // Refresh scores every 5 seconds
    const scoreUpdateInterval = setInterval(refreshScores, 5000);

    // Clear interval when navigating away from the event details
    const clearUpdateInterval = () => {
        clearInterval(scoreUpdateInterval);
    };

    // Call `clearUpdateInterval` when navigating away or as needed
    // For example:
    // document.getElementById('details-container').addEventListener('someEvent', clearUpdateInterval);
};

                    document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    let selectedDate = today;
    let selectedHours = '';

    // Function to update the displayed date
    function updateCalendarDisplay(date) {
        const formattedDate = formatDate(date);
        const currentDayElem = document.getElementById('current-day');
        if (currentDayElem) currentDayElem.innerText = formattedDate;
    }

    // Function to format the date to YYYY-MM-DD
    function formatDate(date) {
        return date.toISOString().split('T')[0]; // Format date as 'YYYY-MM-DD'
    }

    // Fetch and display events for the selected date
    function fetchEventsByDate(date, hours) {
        //console.log('Fetching events for date:', date, 'with hours:', hours);
        // Ensure displayCategories can handle optional status argument
        displayCategories(date, hours);
    }

    // Initial data load: Display today's date and fetch events
    updateCalendarDisplay(today);
    fetchEventsByDate(formatDate(today), selectedHours);

    // Handle 'yesterday' button click
    const yesterdayBtn = document.querySelector('.calendar__navigation--yesterday');
    if (yesterdayBtn) {
        yesterdayBtn.addEventListener('click', () => {
            selectedDate.setDate(selectedDate.getDate() - 1); // Move to the previous day
            updateCalendarDisplay(selectedDate);
            fetchEventsByDate(formatDate(selectedDate), selectedHours);
        });
    }

    // Handle 'tomorrow' button click
    const tomorrowBtn = document.querySelector('.calendar__navigation--tomorrow');
    if (tomorrowBtn) {
        tomorrowBtn.addEventListener('click', () => {
            selectedDate.setDate(selectedDate.getDate() + 1); // Move to the next day
            updateCalendarDisplay(selectedDate);
            fetchEventsByDate(formatDate(selectedDate), selectedHours);
        });
    }

    // Filter events based on the selected time range
    const filterBtn = document.getElementById('filter-btn');
    if (filterBtn) {
        filterBtn.addEventListener('click', () => {
            selectedHours = document.getElementById('time-range').value;
            fetchEventsByDate(formatDate(selectedDate), selectedHours);
        });
    }

    // Main navigation click for filtering by game type (all, live, finished, scheduled)
    document.querySelectorAll('.main-nav a').forEach(link => {
        link.addEventListener('click', async event => {
            event.preventDefault();
            const filterType = link.getAttribute('href').replace('#', '');

            const date = document.getElementById('current-day').innerText;
            let hours = '';
            let status = ''; // Define default status as an empty string

            // Handle different types of game filters
            switch (filterType) {
                case 'all-games':
                    displayCategories(date, hours);
                    break;
                case 'live-games':
                    status = 'live';
                    displayCategories(date, hours, status);
                    break;
                case 'finished-games':
                    status = 'finished';
                    displayCategories(date, hours, status);
                    break;
                case 'scheduled-games':
                    status = 'scheduled';
                    displayCategories(date, hours, status);
                    break;
                default:
                    displayCategories(date, hours);
                    break;
            }

            // Remove 'active' class from all links
            document.querySelectorAll('.main-nav a').forEach(link => {
                link.classList.remove('active');
            });

            // Add 'active' class to the clicked link
            event.target.classList.add('active');
        });
    });
});



        </script> 
    </body>
</html>
