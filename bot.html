<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap" rel="stylesheet">
  <title>Football Tournaments</title>
  <style>
    .rF-4 {
  font-family: "Roboto Flex", sans-serif;
  font-optical-sizing: auto;
  font-weight: 400;
  font-style: normal;
  font-variation-settings:
    "slnt" 0,
    "wdth" 100,
    "GRAD" 0,
    "XOPQ" 96,
    "XTRA" 468,
    "YOPQ" 79,
    "YTAS" 750,
    "YTDE" -203,
    "YTFI" 738,
    "YTLC" 514,
    "YTUC" 712;
}
    .rF-5 {
  font-family: "Roboto Flex", sans-serif;
  font-optical-sizing: auto;
  font-weight: 500;
  font-style: normal;
  font-variation-settings:
    "slnt" 0,
    "wdth" 100,
    "GRAD" 0,
    "XOPQ" 96,
    "XTRA" 468,
    "YOPQ" 79,
    "YTAS" 750,
    "YTDE" -203,
    "YTFI" 738,
    "YTLC" 514,
    "YTUC" 712;
}
    .rF-6 {
  font-family: "Roboto Flex", sans-serif;
  font-optical-sizing: auto;
  font-weight: 600;
  font-style: normal;
  font-variation-settings:
    "slnt" 0,
    "wdth" 100,
    "GRAD" 0,
    "XOPQ" 96,
    "XTRA" 468,
    "YOPQ" 79,
    "YTAS" 750,
    "YTDE" -203,
    "YTFI" 738,
    "YTLC" 514,
    "YTUC" 712;
}
:root {
        --color-white20p: rgb(48, 125, 153);
        --color-black1: rgb(3,5,7);
        --win-color: rgba(27,184,145,.6); /* Wins */
        --draw-color: rgba(229, 156, 3, 0.9);/* Draws */
        --loss-color: rgba(253,29,91,0.5);/* Losses */
}
    body {
        background-color:rgb(0, 0, 0);
        color:rgb(219, 222, 218);
        font-size: 11px;
        margin: 10px;
        display: flex;
        flex-direction: column; 
        height: 100vh;
        overflow: hidden;
    }
    a {
      text-decoration: none;
      color:rgb(219, 222, 218);
    }
h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
}
li {
  list-style: none;
}
.scrollable {
  overflow-y: auto;
  overflow-x: hidden; 
}
.W, .D, .L {
        height: 14px;
        width: 14px;
        color: var(--color-black1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 10px;
    }    

    .W {
        background-color: var(--win-color);
    }
    .D {
        background-color: var(--draw-color);
    }
    .L {
        background-color: var(--loss-color);
    } 
/* Custom scrollbar for WebKit browsers (Chrome, Safari) */
.scrollable::-webkit-scrollbar {
    width: 5px; /* Set scrollbar width to 1px */
    height: 5px; /* Set scrollbar width to 1px */
}

.scrollable::-webkit-scrollbar-track {
  background: var(--color-black1); /* Track color */
}

.scrollable::-webkit-scrollbar-thumb {
  background: var(--color-white20p); /* Thumb color */
  border-radius: 1px; /* Rounded corners for the thumb */
}

.main {
  display: flex;
  background-color: rgb(40, 40, 40);
  border: 1px solid rgb(74, 74, 74);
  flex: 1;
  flex-direction: row;
  height: 100vh;
}

#categories ul, #tournaments ul {
  margin: 0;
  padding: 0;
}

#categories li, #tournaments li {
  margin: 0;
  list-style: none;
} 
#categories  {
  flex: 0.8;
}
.tournaments {
  background-color:rgb(0, 0, 0);
  border-right: 1px solid rgba(40, 40, 40, 0.8);
  border-left: 1px solid rgba(40, 40, 40, 0.8);
  flex: 1;
} 
.tournament-details {
  flex: 6;
  display: flex;
  flex-direction: column;
}
#tournament-details, #tournament-details ul {
  display: flex;
  align-items: center;
  gap: 10px;
}
#tournament-details div {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  padding: 0 10px;
    background-color: white;
}
#tournament-details img {
    height: 45px;
}
#categories a {
  color: rgb(128, 128, 128);
  padding: 3px 0 3px 10px;
  display: flex;
  align-items: center;
} 

.tournaments h2 {
  font-size: 12px;
  text-transform: uppercase;
  text-align: center;
} 
#tournaments a {
  color: rgb(223, 189, 106);
  padding: 3px 0 3px 10px;
  display: flex;
  align-items: center;
} 
#categories li:nth-child(even) {
  background-color:rgb(0, 0, 0);
  border-right: 1px solid rgba(40, 40, 40, 0.8);
}
#tournaments li {
  border-bottom: 1px solid rgba(40, 40, 40, 0.8);
  padding-right: 10px;
}
.tournament-data {
  display: flex;
  flex-direction: row;
  align-items: center;    
    color: white;
    justify-content: space-between;
    border-bottom: 1px solid rgb(48, 125, 153);

}
#rounds, #rounds ul {
  display: flex;
  align-items: center;
}
#rounds {
  display: flex; /* Make the container a flexbox */
  align-items: center; /* Vertically center the content */
  border-bottom: 1px solid #666;
}

#rounds h4 {
    width: 50px;
    margin: 0;
    padding: 12px 10px;
    color: white;
    text-transform: uppercase;
    border-right: 1px solid #666;
    margin-right: 10px;
}

#rounds ul {
  flex-grow: 1; /* Allow the list to grow and fill the remaining space */
  margin: 0; /* Remove default margin */
  padding: 0; /* Remove default padding */
  list-style: none; /* Remove default list styling */
  display: flex; /* Make the list a flex container */
  flex-wrap: nowrap; /* Allow list items to wrap to the next line */
  gap: 1px;
  overflow-x: auto;
  margin-right: 10px;
}

#rounds ul li { 
  text-align: center; /* Center the text inside list items */
}

#rounds ul li a {
  text-decoration: none; /* Remove underline from links */
  color: white; /* Set link text color */
  padding:2px 8px; /* Add padding to links */
  background-color: rgba(255, 255, 255, 0.1); /* Default background color */
  display: block; /* Make links fill the entire list item */
}

#rounds ul li a:hover {
  background-color: rgba(255, 255, 255, 0.2); /* Hover background color */
}

#season-info .stats {
  display: flex; /* Arrange stats in a row */
  gap: 15px; /* Add spacing between stats */
  flex-wrap: wrap; /* Allow wrapping if the container is too small */
}

#season-info .stats div {
  background-color: rgba(255, 255, 255, 0.1); /* Light background for each stat */
  padding: 5px 10px; /* Add padding */
  border-radius: 4px; /* Rounded corners */
  font-size: 14px;
}
#season-select {
  margin-right: 10px;
}
select {
    background-color: #2b3034;
    color: rgb(151, 255, 159);
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
}
.tEs {
  display: flex;
  gap: 5px;
}
.tEs #standings {
  width: 35%;
}
.tEs #tournament-events {
  width: 65%;
}
table {
    width: 100%;
    border-collapse: collapse;
}
table.events-table {
  font-size: 10.5px;
}
table.events-table td, table.events-table th {
  padding: 5px;
}
tr.headerTitle th {
  font-size: 10px;
  font-weight: bold;
  text-align: left;
  color: rgb(255, 255, 255);
  border-bottom: 1px solid rgb(48, 125, 153);
  text-transform: uppercase;
} 

table.events-table tbody tr:nth-child(even), #overall-standings tbody tr:nth-child(even) {
  background-color:rgb(0, 0, 0);
}
table.events-table thead th.score, table.events-table tbody td.score {
  text-align: center;
}

.tabs button {
  background-color: rgba(255, 255, 255, 0.1);
  border: none;
  outline: none;
  cursor: pointer;
  padding: 5px 10px;
  transition: 0.3s;
  color: rgb(179, 179, 179);
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
}

.tabs button:hover {
  background-color: rgb(92, 92, 92);
}

.tabs button.active {
  background-color: rgb(92, 92, 92);
}

.tabs { 
  border-bottom: 1px solid rgb(48, 125, 153); 
}
.tabcontent {
  border: 1px solid rgb(74, 74, 74);
  border-top: none;
  border-right: none;
}

#overall-standings th, #overall-standings td {
  text-align: center; /* Center all text */
  padding: 8px; 
  padding: 5px;
}

#overall-standings td:nth-child(2), #overall-standings th:nth-child(2) {
  text-align: left; /* Align 'Team' column to the left */
} 
.formResult {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2px;
} 
  </style>
</head>
<body class="rF-4">
  <div class="main">
    <div id="categories" class="scrollable"></div>  
    <div class="tournaments scrollable">
      <h2><span id="selected-country"></span></h2>
      <div id="tournaments"></div>
    </div>

    <div class="tournament-details scrollable"> 
      <div class="tournament-data">
        <div id="tournament-details"></div>
        <!-- Season Info -->
        <div id="season-info"></div>
        <!-- Season Selector Dropdown -->
        <select id="season-select"></select> 
      </div>  
        
      <div class="tEs">
        <div id="tournament-events"></div>
        <div id="standings">
          <div id="overall" class="tabcontent scrollable">
            <table id="overall-standings"></table>
          </div> 
          </div>
      </div>
      <!-- groups Info -->
      <div id="groups"></div>
    </div>
</div>

  <script>

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then((registration) => {
        //console.log('Service Worker registered with scope:', registration.scope);
      }).catch((error) => {
        //console.error('Service Worker registration failed:', error);
      });
    });
  }

  // Helper function to convert fractional odds to decimal odds
function fractionalToDecimal(fractional) {
  const [numerator, denominator] = fractional.split('/').map(Number);
  return (numerator / denominator + 1).toFixed(2);
}



let cachedEvents = null; // Global variable to store cached events
let tournamentIds = new Set(); // Global variable to store unique tournament IDs

const scheduledEventsUrl = (date, inverse = false) => 
  `https://api.sofascore.com/api/v1/sport/football/scheduled-events/${date}${inverse ? '/inverse' : ''}`;

// Fetch and cache scheduled events (with optional inverse events)
function fetchAndCacheScheduledEvents(date, includeInverse = false) {
  const urls = [scheduledEventsUrl(date)];
  if (includeInverse) {
    urls.push(scheduledEventsUrl(date, true));
  }

  return Promise.all(urls.map(url => 
    fetch(url)
      .then(response => response.json())
      .then(data => data.events)
      .catch(error => {
        console.error('Error fetching scheduled events:', error);
        return [];
      })
  ))
  .then(results => {
    const allEvents = results.flat();
    cachedEvents = allEvents; // Cache all fetched events

    // Extract and store tournament IDs
    allEvents.forEach(event => {
      const tournamentId = event.tournament.id;
      const uniqueTournamentId = event.tournament.uniqueTournament.id;
      tournamentIds[tournamentId] = uniqueTournamentId;
    });

    return allEvents;
  });
}

// Fetch and display categories with scheduled events
function fetchCategories() {
  const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

  // Fetch and cache scheduled events
  fetchAndCacheScheduledEvents(today)
    .then(events => {
      const categoriesWithEvents = new Set(); // Use a Set to store unique category IDs
      const tournamentsWithEvents = new Set(); // Use a Set to store unique tournament IDs

      // Loop through events and collect unique category and tournament IDs
      events.forEach(event => {
        categoriesWithEvents.add(event.tournament.category.id);
        tournamentsWithEvents.add(event.tournament.uniqueTournament.id);
      });

      // Check if the number of categories is less than 30
      if (categoriesWithEvents.size < 30) {
        return fetchAndCacheScheduledEvents(today, true)
          .then(inverseEvents => {
            inverseEvents.forEach(event => {
              categoriesWithEvents.add(event.tournament.category.id);
              tournamentsWithEvents.add(event.tournament.uniqueTournament.id);
            });
            return { categoriesWithEvents, tournamentsWithEvents };
          });
      } else {
        return { categoriesWithEvents, tournamentsWithEvents };
      }
    })
    .then(({ categoriesWithEvents, tournamentsWithEvents }) => {
      // Fetch all categories
      fetch('https://www.sofascore.com/api/v1/sport/football/categories')
        .then(response => response.json())
        .then(categoriesData => {
          const categoriesContainer = document.getElementById('categories');
          categoriesContainer.innerHTML = '';

          // Filter categories to only include those with scheduled events
          const filteredCategories = categoriesData.categories.filter(category =>
            categoriesWithEvents.has(category.id)
          );

          // Sort filtered categories by priority (descending) and then alphabetically for priority 0
          const sortedCategories = filteredCategories.sort((a, b) => {
            if (a.priority === 0 && b.priority === 0) {
              return a.name.localeCompare(b.name);
            } else if (a.priority === 0) {
              return 1;
            } else if (b.priority === 0) {
              return -1;
            } else {
              return b.priority - a.priority;
            }
          });

          // Create a <ul> element to hold the category links
          const categoryList = document.createElement('ul');
          categoriesContainer.appendChild(categoryList);

          // Loop through sorted categories and create <li> links
          sortedCategories.forEach((category, index) => {
            const listItem = document.createElement('li');
            const categoryLink = document.createElement('a');
            categoryLink.href = '#'; // Use a placeholder href
            categoryLink.textContent = category.name;
            categoryLink.onclick = (e) => {
              e.preventDefault(); // Prevent the default link behavior
              fetchTournaments(category.id, category.name, tournamentsWithEvents);
            };

            listItem.appendChild(categoryLink);
            categoryList.appendChild(listItem);

            // Auto-click the first category to load its tournaments
            if (index === 0) {
              fetchTournaments(category.id, category.name, tournamentsWithEvents);
            }
          });
        })
        .catch(error => console.error('Error fetching categories:', error));
    })
    .catch(error => console.error('Error fetching scheduled events:', error));
}

let finishedTournamentEvents = {}; // Global variable to store finished events

function fetchScheduledEvents(uniqueTournamentId, date) {
  if (cachedEvents) {
    // Use cached events if available
    const filteredEvents = cachedEvents.filter(event =>
      event.tournament.uniqueTournament.id === uniqueTournamentId
    );

    // Extract tournamentId and seasonId from the first event in filteredEvents
    const tournamentId = filteredEvents[0]?.tournament?.id;
    const seasonId = filteredEvents[0]?.season?.id;

    if (!tournamentId || !seasonId) {
      console.error('Tournament ID or Season ID not found in filtered events');
      return;
    }

    // Fetch tournament events to populate finishedTournamentEvents
    fetchTournamentEvents(tournamentId, seasonId)
      .then(() => { 
        const standings = calculateStandings(finishedTournamentEvents); // Calculate standings
        console.log('Standings:', standings);
        displayEventsInTable(filteredEvents, uniqueTournamentId, date, standings); // Pass standings
      })
      .catch(error => console.error('Error fetching tournament events:', error));
  } else {
    // Fetch and cache events if not already cached
    fetchAndCacheScheduledEvents(date)
      .then(events => {
        const filteredEvents = events.filter(event =>
          event.tournament.uniqueTournament.id === uniqueTournamentId
        );

        // Extract tournamentId and seasonId from the first event in filteredEvents
        const tournamentId = filteredEvents[0]?.tournament?.id;
        const seasonId = filteredEvents[0]?.season?.id;

        if (!tournamentId || !seasonId) {
          console.error('Tournament ID or Season ID not found in filtered events');
          return;
        }

        // Fetch tournament events to populate finishedTournamentEvents
        fetchTournamentEvents(tournamentId, seasonId)
          .then(() => {
            const standings = calculateStandings(finishedTournamentEvents); // Calculate standings
            console.log('Standings:', standings);
            displayEventsInTable(filteredEvents, uniqueTournamentId, date, standings); // Pass standings
          })
          .catch(error => console.error('Error fetching tournament events:', error));
      })
      .catch(error => console.error('Error fetching scheduled events:', error));
  }
}

function fetchTournamentEvents(tournamentId, seasonId) {
  return fetch(`https://api.sofascore.com/api/v1/tournament/${tournamentId}/season/${seasonId}/events`)
    .then(response => response.json())
    .then(data => {
      finishedTournamentEvents = data.events.filter(event => event.status.type === "finished"); // Populate global variable
      

      const standings = calculateStandings(finishedTournamentEvents);
      displayStandings(standings);
      console.log('Fetched Finished Tournament Events (Excluded Same Day Events):', finishedTournamentEvents);
      
      return finishedTournamentEvents;
    })
    .catch(error => {
      console.error('Error fetching tournament events:', error);
      return [];
    });
}


function calculateTeamStrength(results) {
  // Count the number of wins, draws, and losses in the last 10 results
  const wins = results.filter(result => result === "W").length;
  const draws = results.filter(result => result === "D").length;
  const losses = results.filter(result => result === "L").length;

  // Calculate the total number of games (should be 10 or less)
  const totalGames = results.length;

  // Calculate the value of a win (W), draw (D), and loss (L)
  const winValue = 100 / totalGames;
  const drawValue = 0.709 * winValue;
  const lossValue = -0.345 * winValue;

  // Calculate the total score
  const totalScore = (wins * winValue) + (draws * drawValue) + (losses * lossValue);

  // Map the total score to the difficulty level
  let difficultyLevel;
  if (totalScore >= 0 && totalScore <= 15) {
    difficultyLevel = 1; // Very Easy
  } else if (totalScore > 15 && totalScore <= 35) {
    difficultyLevel = 2; // Easy
  } else if (totalScore > 35 && totalScore <= 65) {
    difficultyLevel = 3; // Medium
  } else if (totalScore > 65 && totalScore <= 85) {
    difficultyLevel = 4; // Hard
  } else if (totalScore > 85 && totalScore <= 100) {
    difficultyLevel = 5; // Very Hard
  } else {
    difficultyLevel = "Invalid"; // Handle edge cases
  }

  // Return the results
  return {
    totalScore: totalScore.toFixed(2), // Round to 2 decimal places
    difficultyLevel: difficultyLevel,
  };
}

function displayEventsInTable(events, tournamentId, date, teams) {
  const eventsContainer = document.getElementById('tournament-events');
  eventsContainer.innerHTML = ''; // Clear previous content

  // Create a table element for the event display
  const table = document.createElement('table');
  table.classList.add('events-table');
  table.innerHTML = `
    <thead>
      <tr class="headerTitle">
        <th>Time</th>
        <th>Home</th>
        <th>Away</th>
        <th>HS</th><!-- Home Strength -->
        <th>AS</th><!-- Away Strength -->
        <th>1</th>
        <th>X</th>
        <th>2</th>
        <th class="score">Score</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  `;
  eventsContainer.appendChild(table);

  // Fetch odds for the events (if needed)
  const oddsUrl = `https://www.sofascore.com/api/v1/sport/football/odds/1/${date}`;
  fetch(oddsUrl)
    .then(response => response.json())
    .then(oddsData => {
      // Loop through events and create table rows
      events.forEach(event => {
        const eventId = event.id;
        const homeTeam = event.homeTeam.shortName;
        const awayTeam = event.awayTeam.shortName;
        const eventDate = new Date(event.startTimestamp * 1000);
        const startTime = eventDate.toLocaleDateString('en-GB') + ' ' + 
                                  eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });

        // Calculate team strength for home and away teams
        const homeTeamStrength = calculateTeamStrength(teams[event.homeTeam.id].results);
        const awayTeamStrength = calculateTeamStrength(teams[event.awayTeam.id].results);

        // Default values for odds
        let odds1 = '-';
        let oddsX = '-';
        let odds2 = '-';

        // Find the odds for this event (if available) by checking if the eventId exists in the odds data
        const eventOdds = oddsData.odds[eventId];
        if (eventOdds) {
          const choices = eventOdds.choices || []; 

          // Find the odds for '1', 'X', and '2'
          odds1 = choices.find(choice => choice.name === '1')?.initialFractionalValue || '-';
          oddsX = choices.find(choice => choice.name === 'X')?.initialFractionalValue || '-';
          odds2 = choices.find(choice => choice.name === '2')?.initialFractionalValue || '-';

          // Convert fractional odds to decimal odds
          odds1 = odds1 !== '-' ? fractionalToDecimal(odds1) : '-';
          oddsX = oddsX !== '-' ? fractionalToDecimal(oddsX) : '-';
          odds2 = odds2 !== '-' ? fractionalToDecimal(odds2) : '-';
        } else {
          console.warn(`No odds found for event ${eventId}`);
        }

        // Create a table row with or without odds
        const row = document.createElement('tr');
        row.innerHTML = `
          <td width="100">${startTime}</td>
          <td width="140">${homeTeam}</td>
          <td width="140">${awayTeam}</td>
          <td width="100">${homeTeamStrength.difficultyLevel}</td>
          <td width="100">${awayTeamStrength.difficultyLevel}</td>
          <td width="30">${odds1}</td>
          <td width="30">${oddsX}</td>
          <td width="30">${odds2}</td>
          <td class="score" width="40">${event.homeScore?.current ?? ''} - ${event.awayScore?.current ?? ''} </td>
        `;
        table.querySelector('tbody').appendChild(row);
      });
    })
    .catch(error => console.error('Error fetching odds:', error));
}

function calculateStandings(events) {
  const teams = {};

  events.forEach(event => {
    const homeTeamId = event.homeTeam.id; // Use team ID instead of name
    const awayTeamId = event.awayTeam.id; // Use team ID instead of name
    const homeScore = event.homeScore.current;
    const awayScore = event.awayScore.current;

    if (!teams[homeTeamId]) teams[homeTeamId] = initializeTeamStats(event.homeTeam.shortName); // Pass team name for display
    if (!teams[awayTeamId]) teams[awayTeamId] = initializeTeamStats(event.awayTeam.shortName); // Pass team name for display

    updateStandings(teams, homeTeamId, awayTeamId, homeScore, awayScore);
  });

  return teams; // Return the teams object
}


function initializeTeamStats(teamName) {
  return {
    name: teamName, // Store team name for display
    overall: { played: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0 },
    results: [] // Array to store the last 10 results
  };
}

function updateStandings(teams, homeTeamId, awayTeamId, homeScore, awayScore) {
  teams[homeTeamId].overall.played++;
  teams[awayTeamId].overall.played++;
  teams[homeTeamId].overall.goalsFor += homeScore;
  teams[homeTeamId].overall.goalsAgainst += awayScore;
  teams[awayTeamId].overall.goalsFor += awayScore;
  teams[awayTeamId].overall.goalsAgainst += homeScore;

  if (homeScore > awayScore) {
    handleResult(teams, homeTeamId, awayTeamId, "W", "L");
  } else if (homeScore < awayScore) {
    handleResult(teams, awayTeamId, homeTeamId, "W", "L");
  } else {
    handleResult(teams, homeTeamId, awayTeamId, "D", "D");
  }
}

function handleResult(teams, homeTeamId, awayTeamId, resultHome, resultAway) {
  if (resultHome === "W") {
    teams[homeTeamId].overall.wins++;
    teams[homeTeamId].overall.points += 3;
    teams[awayTeamId].overall.losses++;
  } else if (resultHome === "L") {
    teams[awayTeamId].overall.wins++;
    teams[awayTeamId].overall.points += 3;
    teams[homeTeamId].overall.losses++;
  } else { // Draw Case
    teams[homeTeamId].overall.draws++;
    teams[awayTeamId].overall.draws++;
    teams[homeTeamId].overall.points += 1;
    teams[awayTeamId].overall.points += 1;
  }

  teams[homeTeamId].results.push(resultHome);
  teams[awayTeamId].results.push(resultAway);
}

function displayStandings(standings) {
  document.getElementById('overall-standings').innerHTML = generateTableHTML(standings, 'overall');
}

function generateTableHTML(standings, type) {
  let html = `
    <tr>
      <th>#</th>
      <th>Team</th>
      <th>P</th>
      <th>W</th>
      <th>D</th>
      <th>L</th>
      <th>DIFF</th>
      <th>Goals</th>
      <th>Last 5</th>
      <th>Pts</th>
    </tr>
  `;

  const sortedTeams = Object.keys(standings).sort((a, b) => {
    if (standings[b][type].points !== standings[a][type].points) {
      return standings[b][type].points - standings[a][type].points;
    }
    return (standings[b][type].goalsFor - standings[b][type].goalsAgainst) -
           (standings[a][type].goalsFor - standings[a][type].goalsAgainst);
  });

  sortedTeams.forEach((teamId, index) => {
    const stats = standings[teamId][type];
    const goalDifference = stats.goalsFor - stats.goalsAgainst;
    const goals = `${stats.goalsFor}:${stats.goalsAgainst}`;
    const last5Results = standings[teamId].results.slice(-5).map(result => `<span class="${result}">${result}</span>`).join("");

    html += `
      <tr>
        <td>${index + 1}</td>
        <td>${standings[teamId].name}</td> <!-- Use team name for display -->
        <td>${stats.played}</td>
        <td>${stats.wins}</td>
        <td>${stats.draws}</td>
        <td>${stats.losses}</td>
        <td>${goalDifference}</td>
        <td>${goals}</td>
        <td class="formResult">${last5Results}</td>
        <td>${stats.points}</td>
      </tr>
    `;
  });

  return html;
}


function fetchTournaments(categoryId, categoryName, tournamentsWithEvents) {
  const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

  // Fetch tournaments for the category
  fetch(`https://www.sofascore.com/api/v1/category/${categoryId}/tournaments`)
    .then(response => response.json())
    .then(tournamentsData => {
      const tournamentsContainer = document.getElementById('tournaments');
      tournamentsContainer.innerHTML = '';

      // Filter tournaments to only include those with scheduled events
      const filteredTournaments = tournamentsData.tournaments.filter(tournament =>
        tournamentsWithEvents.has(tournament.uniqueTournament.id)
      );

      // Create a <ul> element to hold the tournament links
      const tournamentList = document.createElement('ul');
      tournamentsContainer.appendChild(tournamentList);

      // Loop through filtered tournaments and create <li> links
      filteredTournaments.forEach((tournament, index) => {
        const listItem = document.createElement('li');
        const tournamentLink = document.createElement('a');
        tournamentLink.href = '#'; // Use a placeholder href
        tournamentLink.textContent = tournament.name;
        tournamentLink.onclick = (e) => {
          e.preventDefault(); // Prevent the default link behavior
          const seasonId = tournament.season.id; // Get the season ID
          fetchScheduledEvents(tournament.uniqueTournament.id, today);
        };

        listItem.appendChild(tournamentLink);
        tournamentList.appendChild(listItem);

        // Auto-click the first tournament to load its events
        if (index === 0) {
          const seasonId = tournament.season.id; // Get the season ID
          fetchScheduledEvents(tournament.uniqueTournament.id, today);
        }
      });
    })
    .catch(error => console.error('Error fetching tournaments:', error));
}

 

function fetchSeasonInfo(uniqueTournamentId, tournamentName, seasonId) {
  fetch(`https://www.sofascore.com/api/v1/unique-tournament/${uniqueTournamentId}/season/${seasonId}/info`)
    .then(response => response.json())
    .then(data => {
      const seasonInfoContainer = document.getElementById('season-info');
      
      // Calculate total matches
      const totalMatches = data.info.homeTeamWins + data.info.awayTeamWins + data.info.draws;
      
      // Calculate percentages
      const homeWinPercentage = ((data.info.homeTeamWins / totalMatches) * 100).toFixed(0);
      const awayWinPercentage = ((data.info.awayTeamWins / totalMatches) * 100).toFixed(0);
      const drawPercentage = ((data.info.draws / totalMatches) * 100).toFixed(0);
      
      // Display the stats with percentages
      seasonInfoContainer.innerHTML = `  
        <div class="stats">
          <div><strong>G:</strong> ${data.info.goals}</div>
          <div><strong>HW:</strong> ${data.info.homeTeamWins} (${homeWinPercentage}%)</div>
          <div><strong>AW:</strong> ${data.info.awayTeamWins} (${awayWinPercentage}%)</div>
          <div><strong>D:</strong> ${data.info.draws} (${drawPercentage}%)</div>
        </div>
      `;

      // Find the tournamentId for the given uniqueTournamentId
      const tournamentId = Object.keys(tournamentIds).find(
        key => tournamentIds[key] === uniqueTournamentId
      );

      if (tournamentId) {
        // Fetch and display tournament events for the selected season
        fetchTournamentEvents(tournamentId, seasonId);
      } else {
        console.error('Tournament ID not found for uniqueTournamentId:', uniqueTournamentId);
      }
    })
    .catch(error => console.error('Error fetching season info:', error));
}

 

function fetchTournamentDetails(uniqueTournamentId) { 
  fetch(`https://www.sofascore.com/api/v1/unique-tournament/${uniqueTournamentId}`)
    .then(response => response.json())
    .then(data => {
      const tournamentDetailsContainer = document.getElementById('tournament-details');
      const uniqueTournament = data.uniqueTournament;

      // Display tournament details
      const tournamentImage = `https://img.sofascore.com/api/v1/unique-tournament/${uniqueTournament.id}/image`;
      tournamentDetailsContainer.innerHTML = `        
        <div><img src="${tournamentImage}" alt="${uniqueTournament.name} logo"></div>
        <h3>${uniqueTournament.name}</h3>        
        <ul>
          <li><strong>Rs:</strong> ${uniqueTournament.hasRounds ? 'Yes' : 'No'}</li>
          <li><strong>Gs:</strong> ${uniqueTournament.hasGroups ? 'Yes' : 'No'}</li>
          <li><strong>PS:</strong> ${uniqueTournament.hasPlayoffSeries ? 'Yes' : 'No'}</li>
          <li><strong>PG:</strong> ${uniqueTournament.hasPerformanceGraphFeature ? 'Yes' : 'No'}</li>
        </ul>
      `; 

      // Fetch and display seasons for the selected tournament
      fetchSeasons(uniqueTournament.id, uniqueTournament.name);
  
      // Fetch events for the tournament
      fetchEventsForTournament(uniqueTournament.id, uniqueTournament.name);
    })
    .catch(error => console.error('Error fetching tournament details:', error));
}

// Fetch and display seasons for a selected tournament
function fetchSeasons(uniqueTournamentId, tournamentName) {
  fetch(`https://www.sofascore.com/api/v1/unique-tournament/${uniqueTournamentId}/seasons`)
    .then(response => response.json())
    .then(data => {
      const seasonSelect = document.getElementById('season-select');
      seasonSelect.innerHTML = ''; // Clear previous options

      // Create a default "Select Season" option
      const defaultOption = document.createElement('option');
      defaultOption.textContent = "Season";
      defaultOption.value = "";
      seasonSelect.appendChild(defaultOption);

      // Loop through the seasons and create an option for each one
      data.seasons.forEach((season, index) => {
        const option = document.createElement('option');
        option.value = season.id;
        option.textContent = season.year;
        seasonSelect.appendChild(option);

        // Automatically select the first season and fetch its info
        if (index === 0) {
          option.selected = true;
          fetchSeasonInfo(uniqueTournamentId, tournamentName, season.id); // Fetch the first season's info
        }
      });

      // Add event listener for changing season
      seasonSelect.onchange = () => {
        const selectedSeasonId = seasonSelect.value;
        if (selectedSeasonId) {
          fetchSeasonInfo(uniqueTournamentId, tournamentName, selectedSeasonId);
        }
      };
    })
    .catch(error => console.error('Error fetching seasons:', error));
}

// Fetch rounds for the tournament and season
function fetchRounds(tournamentId, seasonId) {
  fetch(`https://www.sofascore.com/api/v1/unique-tournament/${tournamentId}/season/${seasonId}/rounds`)
    .then(response => response.json())
    .then(data => {
      const roundsContainer = document.getElementById('rounds');
      roundsContainer.innerHTML = '<h4>Rounds</h4>';
      
      // Check if the rounds property exists and is an array
      if (data.rounds && Array.isArray(data.rounds)) {
        const currentRound = data.currentRound?.round; // Get the current round number

        // Create a <ul> element to hold the round links
        const roundList = document.createElement('ul');
            // Add the class to the list item
            roundList.classList.add('scrollable'); // Correctly adding the class here
        roundsContainer.appendChild(roundList);

        // Loop through rounds and create <li> links
        data.rounds.forEach(round => {
          const listItem = document.createElement('li');
  
          const roundLink = document.createElement('a');
          roundLink.href = '#'; // Use a placeholder href
          roundLink.textContent = `${round.round}`;
          roundLink.onclick = (e) => {
            e.preventDefault(); // Prevent the default link behavior
            fetchEventsForRound(tournamentId, round.round);
          };

          // Highlight the current round
          if (round.round === currentRound) {
            roundLink.style.backgroundColor = '#4CAF50'; // Green background for the current round
            roundLink.style.color = 'white'; // White text for better contrast
            roundLink.style.padding = '2px 8px'; // Add padding for better appearance
          }

          listItem.appendChild(roundLink);
          roundList.appendChild(listItem);
        });
      } else {
        roundsContainer.innerHTML = '<p>No rounds data available.</p>';
      }
    })
    .catch(error => {
      console.error('Error fetching rounds:', error);
      document.getElementById('rounds').innerHTML = '<p>Failed to load rounds.</p>';
    });
}

// Fetch tournaments for a selected category
function fetchTournaments(categoryId, categoryName, tournamentsWithEvents) {
  document.getElementById('selected-country').textContent = categoryName;

  fetch(`https://www.sofascore.com/api/v1/category/${categoryId}/unique-tournaments`)
    .then(response => response.json())
    .then(data => {
      const tournamentsContainer = document.getElementById('tournaments');
      tournamentsContainer.innerHTML = '';

      // Ensure groups exist in data before accessing them
      if (data.groups && data.groups.length > 0) {
        // Create a <ul> element to hold the tournament links
        const tournamentList = document.createElement('ul');
        tournamentsContainer.appendChild(tournamentList);

        // Filter tournaments to only include those with scheduled events
        const filteredTournaments = data.groups.flatMap(group =>
          group.uniqueTournaments.filter(tournament => 
            tournamentsWithEvents.has(tournament.id)
          ) // <- Closing parenthesis was missing
        );

        // Display the filtered tournaments
        if (filteredTournaments.length > 0) {
          filteredTournaments.forEach((tournament, index) => {
            const listItem = document.createElement('li');
            const tournamentLink = document.createElement('a');
            tournamentLink.href = '#'; // Use a placeholder href
            tournamentLink.textContent = tournament.name;
            tournamentLink.onclick = (e) => {
              e.preventDefault(); // Prevent the default link behavior
              fetchTournamentDetails(tournament.id);
            };

            listItem.appendChild(tournamentLink);
            tournamentList.appendChild(listItem);

            // Auto-click the first tournament to load its details
            if (index === 0) {
              fetchTournamentDetails(tournament.id);
            }
          });
        } else {
          tournamentsContainer.textContent = 'No tournaments with events found.';
        }
      } else {
        tournamentsContainer.textContent = 'No tournaments available for this category.';
      }
    })
    .catch(error => console.error('Error fetching tournaments:', error));
}
// Fetch events for a specific tournament (no need for rounds)
function fetchEventsForTournament(tournamentId, tournamentName) {
  const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format
  // No need to check for rounds here, just fetch scheduled events directly
  fetchScheduledEvents(tournamentId, today);
}


// Helper function to convert fractional odds to decimal odds
function fractionalToDecimal(fractional) {
  const [numerator, denominator] = fractional.split('/').map(Number);
  return (numerator / denominator + 1).toFixed(2);
}

// Initialize the app
fetchCategories();
</script>
</body>
</html>
